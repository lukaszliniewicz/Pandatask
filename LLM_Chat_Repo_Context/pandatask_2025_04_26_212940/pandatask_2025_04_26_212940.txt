Folder structure:
├── pandatask/
├── desktop.ini
├── pandatask.php
├── README.md
├── README.txt
├── assets/
│   ├── css/
│   │   ├── jquery-ui.css
│   │   ├── pandat69-style.css
│   ├── js/
│   │   ├── pandat69-script.js
├── includes/
│   ├── class-pandat69-ajax.php
│   ├── class-pandat69-buddypress.php
│   ├── class-pandat69-db.php
│   ├── class-pandat69-deadline-notifications.php
│   ├── class-pandat69-email.php
│   ├── class-pandat69-group-extension.php
│   ├── class-pandat69-notifications.php
│   ├── class-pandat69-shortcode.php
├── LLM_Chat_Repo_Context/
│   ├── pandatask_2025_04_26_212940/

Concatenated content:

---/---


--README.md--

# Pandatask

A WordPress plugin that adds task management boards, including in BuddyPress groups (can be turned on for individual groups), via a shortcode.

![Task Board Screenshot](https://github.com/user-attachments/assets/08a516fc-2987-486f-8dab-8ff3f79c9190)

## Overview

This plugin provides a way to display and manage task lists directly within WordPress pages or posts. It uses a shortcode, `[task_board]`, to render the board interface. You can create multiple distinct boards by specifying a unique `board_name` in the shortcode.

## Features

- **Shortcode Driven:** Add a task board anywhere using `[task_board board_name="your_unique_board_name"]`.
- **Multiple Boards:** Create different boards for different projects or contexts using unique `board_name` values.
- **Task Management:**
  - Create tasks with a name and description (using a basic TinyMCE editor).
  - Set task status (Pending, In Progress, Done).
  - Assign task priority (1-10).
  - Organize tasks with categories (managed per board).
  - Set optional deadlines using a datepicker.
  - Assign tasks to one or more registered WordPress users (uses autocomplete search).
- **Comments:** Add comments to tasks. Supports @mentioning other registered users.
- **Filtering & Sorting:** Search tasks by keyword, filter by status, and sort by name, priority, deadline, or status.
- **User Assignment:** Search and select registered WordPress users to assign to tasks.
- **BuddyPress Integration (Optional):** If BuddyPress is active, the plugin can add a "Tasks" tab to groups.
  - Each group gets its own task board (using `board_name="group_X"` where X is the group ID).
  - Group admins can enable/disable the Tasks feature in the group settings.
  - User assignment searches BuddyPress members within the group context.
- **Email Notifications:** Sends email notifications to users when they are assigned to a task or when a comment is added to a task they are assigned to.

## Requirements

- WordPress 5.0 or higher (tested up to 6.8)
- PHP 7.4 or higher
- jQuery (Bundled with WordPress)
- jQuery UI (Datepicker, Autocomplete - Bundled with WordPress)
- TinyMCE (Bundled with WordPress)
- BuddyPress (Optional, but recommended for group-based task management and better permission handling)

## Installation

1. Download the plugin ZIP file (`pandatask.zip`).
2. Log in to your WordPress admin area.
3. Go to `Plugins` -> `Add New`.
4. Click `Upload Plugin` at the top.
5. Upload the ZIP file you downloaded.
6. Activate the plugin through the 'Plugins' menu in WordPress.

Alternatively, you can unzip the plugin and upload the `pandatask` folder to your `/wp-content/plugins/` directory via FTP, then activate it from the Plugins menu.

## Usage

1. Create a new Page or Post (or edit an existing one).
2. Add the following shortcode to the content area:
   `[task_board board_name="project_alpha"]`
   - **Important:** Replace `"project_alpha"` with a unique identifier for this specific board. Use lowercase letters, numbers, and underscores only. Each board needs a different `board_name`.
3. Publish or update the Page/Post.
4. View the page on the front-end. You should see the task board interface.

### Permissions (Standalone Boards)

For boards created directly on pages/posts using the shortcode (like `[task_board board_name="some_board"]`), the default behavior relies on the page/post visibility. Logged-in users who can view the page can generally interact with the board (add tasks, comments, etc.).

### BuddyPress Groups

If you have BuddyPress active with the Groups component enabled:

1. When creating or editing a group, you will see an option to "Enable task board for this group".
2. If enabled, a "Tasks" tab will appear in the group's navigation.
3. This tab displays a task board specific to that group. The plugin automatically uses a `board_name` like `group_123` (where `123` is the group ID). You don't need to manually add the shortcode for group boards.
4. User assignment within a group task board will primarily search members of that group.

### Permissions (BuddyPress Groups)

When used within BuddyPress groups, access control to the task board itself is primarily managed by the **group's settings**:

1. In a **Private** or **Hidden** group, only members of that group will be able to access the "Tasks" tab and interact with the board.
2. In a **Public** group, any site member might be able to view the tab (depending on BuddyPress settings), but interaction (adding tasks, commenting) typically requires group membership.

The plugin leverages BuddyPress's existing group privacy and membership system for access control to the board.

*Note: Within the board itself, there are currently no specific roles defined (e.g., task manager vs. regular user)*.

### Limitations

- Standalone boards (not in groups) have basic permission handling based on page visibility. The BuddyPress integration provides more robust access control via group membership.
- Relies heavily on the WordPress/BuddyPress user system for assignments and comments.
- No granular roles defined within the task board itself (e.g., admin vs. member).

## Screenshots

![Task Board Screenshot](https://github.com/user-attachments/assets/08a516fc-2987-486f-8dab-8ff3f79c9190)

## Changelog

### 1.0.7
- Fix: Corrected text domain path declaration.
- Fix: Removed redundant TinyMCE script enqueue, relying on wp_enqueue_editor().
- Fix: Updated README.md to meet WordPress.org standards (Headers, Stable Tag, Tested Up To, License).
- Fix: Corrected translation usage in email signature.
- Minor code standard adjustments.

### 1.0.0
- Initial release.

## Plugin Info

- Contributors: lukaszliniewicz
- Tags: task, project management, buddypress, todo, tasks
- Requires at least: WordPress 5.0
- Tested up to: WordPress 6.8
- Stable tag: 1.0.7
- Requires PHP: 7.4
- License: GPL v2 or later
- License URI: https://www.gnu.org/licenses/gpl-2.0.html

--README.txt--



--desktop.ini--

[ViewState]
Mode=
Vid=
FolderType=Generic


--pandatask.php--

<?php
/**
 * Plugin Name:       Pandatask
 * Description:       Adds a shortcode [task_board board_name="unique_board_id"] to display a task management board.
 * Version:           1.0.8
 * Author:            Lukasz Liniewicz
 * Author URI:        https://github.com/lukaszliniewicz
 * Plugin URI:        https://github.com/lukaszliniewicz/Pandatask
 * License:           GPL v2 or later
 * License URI:       https://www.gnu.org/licenses/gpl-2.0.html
 * Text Domain:       pandatask
 */

if ( ! defined( 'ABSPATH' ) ) {
    exit; // Exit if accessed directly.
}

// Define constants
define( 'PANDAT69_VERSION', '1.0.8' );
define( 'PANDAT69_PLUGIN_DIR', plugin_dir_path( __FILE__ ) );
define( 'PANDAT69_PLUGIN_URL', plugin_dir_url( __FILE__ ) );
define( 'PANDAT69_PLUGIN_FILE', __FILE__ );

// Include necessary files
require_once PANDAT69_PLUGIN_DIR . 'includes/class-pandat69-db.php';
require_once PANDAT69_PLUGIN_DIR . 'includes/class-pandat69-shortcode.php';
require_once PANDAT69_PLUGIN_DIR . 'includes/class-pandat69-ajax.php';
require_once PANDAT69_PLUGIN_DIR . 'includes/class-pandat69-email.php';
require_once PANDAT69_PLUGIN_DIR . 'includes/class-pandat69-notifications.php';
require_once PANDAT69_PLUGIN_DIR . 'includes/class-pandat69-deadline-notifications.php';



/**
 * Load BuddyPress integration if BuddyPress is active.
 */
function pandat69_load_buddypress_integration() {
    // Check if BuddyPress function exists AND our integration class hasn't been loaded yet
    if ( function_exists( 'buddypress' ) && ! class_exists( 'Pandat69_BuddyPress' ) ) {
        require_once PANDAT69_PLUGIN_DIR . 'includes/class-pandat69-buddypress.php';
        // Use the singleton pattern getter
        Pandat69_BuddyPress::get_instance();
    }
}
// Increase priority slightly to ensure BuddyPress is loaded first (default is 10)
add_action( 'plugins_loaded', 'pandat69_load_buddypress_integration', 20 );

/**
 * Activation hook callback.
 */
function pandat69_activate_plugin() {
    // Ensure DB class is loaded before calling activate
    require_once PANDAT69_PLUGIN_DIR . 'includes/class-pandat69-db.php';
    if ( class_exists( 'Pandat69_DB' ) ) {
        Pandat69_DB::activate();
    }
}
register_activation_hook( PANDAT69_PLUGIN_FILE, 'pandat69_activate_plugin' );

/**
 * Initialize plugin classes after plugins are loaded.
 */
function pandat69_initialize_plugin() {
    // Initialize classes if they exist
    if ( class_exists( 'Pandat69_Shortcode' ) ) {
        $pandat69_shortcode = new Pandat69_Shortcode();
        $pandat69_shortcode->register();
    }

    if ( class_exists( 'Pandat69_Ajax' ) ) {
        $pandat69_ajax = new Pandat69_Ajax();
        $pandat69_ajax->register();
    }
    
    // Initialize notifications integration
    if ( class_exists( 'Pandat69_Notifications' ) ) {
        Pandat69_Notifications::init();
    }
}
add_action('plugins_loaded', 'pandat69_initialize_plugin');


/**
 * Enqueue scripts and styles.
 */
function pandat69_enqueue_scripts() {

    // Only enqueue on front-end. Consider adding checks if the shortcode is actually present.
    if ( is_admin() ) {
        return;
    }

    // Enqueue Styles
    wp_enqueue_style(
        'pandat69-jquery-ui-base',
        PANDAT69_PLUGIN_URL . 'assets/css/jquery-ui.css', 
        array(), 
        '1.12.1' 
    );    wp_enqueue_style( 'pandat69-style', PANDAT69_PLUGIN_URL . 'assets/css/pandat69-style.css', array(), PANDAT69_VERSION );

    // Enqueue Scripts
    wp_enqueue_script( 'jquery' );
    wp_enqueue_script( 'jquery-ui-datepicker' );
    wp_enqueue_script( 'jquery-ui-autocomplete' );

    // Enqueue WordPress editor assets (for TinyMCE dependencies)
    wp_enqueue_editor();

    // Enqueue your custom script
    wp_enqueue_script(
        'pandat69-script',
        PANDAT69_PLUGIN_URL . 'assets/js/pandat69-script.js',
        array( 'jquery', 'jquery-ui-datepicker', 'jquery-ui-autocomplete', 'editor', 'quicktags' ),
        PANDAT69_VERSION,
        true // Load in footer
    );

    // Localize script - Pass data to JavaScript
    $tinymce_settings = array(
        'selector' => '.pandat69-tinymce-editor', // Target class
        'plugins' => 'lists link image', // Keep desired plugins
        'toolbar' => 'undo redo | formatselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image | code', // Simplified toolbar
        'menubar' => false, // Hide the menubar
        'height' => 200, // Set a default height
        'promotion' => false, // Disable "Upgrade" promotion in TinyMCE 6+
    );

    wp_localize_script(
        'pandat69-script',
        'pandat69_ajax_object',
        array(
            'ajax_url' => admin_url( 'admin-ajax.php' ),
            'nonce'    => wp_create_nonce( 'pandat69_ajax_nonce' ),
            'current_user_id' => get_current_user_id(),
            // Get display name safely
            'current_user_display_name' => ( is_user_logged_in() ? wp_get_current_user()->display_name : '' ),
            'tinymce_settings' => $tinymce_settings,
            'text' => array(
                'confirm_delete_task'     => esc_js(__( 'Are you sure you want to delete this task?', 'pandatask' )),
                'confirm_delete_category' => esc_js(__( 'Are you sure you want to delete this category? Tasks using it will lose their category.', 'pandatask' )),
                'error_general'           => esc_js(__( 'An error occurred. Please try again.', 'pandatask' )),
                'no_results_found'        => esc_js(__( 'No users found', 'pandatask' )),
                'type_to_search'          => esc_js(__( 'Type to search users...', 'pandatask' )),
                'searching'               => esc_js(__( 'Searching...', 'pandatask' )),
            )
        )
    );
}
add_action( 'wp_enqueue_scripts', 'pandat69_enqueue_scripts' );

/**
 * Check if BuddyPress is active.
 * Uses bp_is_active to check if the core component is running.
 *
 * @return bool True if BuddyPress is active, false otherwise.
 */
function pandat69_is_buddypress_active() {
    // Check if the main BuddyPress function exists AND the core component is active.
    return function_exists( 'buddypress' ) && bp_is_active('activity'); // Check a core component like activity

}

---LLM_Chat_Repo_Context/---


---LLM_Chat_Repo_Context\pandatask_2025_04_26_212940/---


---assets/---


---assets\css/---


--jquery-ui.css--

/*! jQuery UI - v1.12.1 - 2016-09-14
* http://jqueryui.com
* Includes: core.css, accordion.css, autocomplete.css, menu.css, button.css, controlgroup.css, checkboxradio.css, datepicker.css, dialog.css, draggable.css, resizable.css, progressbar.css, selectable.css, selectmenu.css, slider.css, sortable.css, spinner.css, tabs.css, tooltip.css, theme.css
* To view and modify this theme, visit http://jqueryui.com/themeroller/?ffDefault=Arial%2CHelvetica%2Csans-serif&fsDefault=1em&fwDefault=normal&cornerRadius=3px&bgColorHeader=e9e9e9&bgTextureHeader=flat&borderColorHeader=dddddd&fcHeader=333333&iconColorHeader=444444&bgColorContent=ffffff&bgTextureContent=flat&borderColorContent=dddddd&fcContent=333333&iconColorContent=444444&bgColorDefault=f6f6f6&bgTextureDefault=flat&borderColorDefault=c5c5c5&fcDefault=454545&iconColorDefault=777777&bgColorHover=ededed&bgTextureHover=flat&borderColorHover=cccccc&fcHover=2b2b2b&iconColorHover=555555&bgColorActive=007fff&bgTextureActive=flat&borderColorActive=003eff&fcActive=ffffff&iconColorActive=ffffff&bgColorHighlight=fffa90&bgTextureHighlight=flat&borderColorHighlight=dad55e&fcHighlight=777620&iconColorHighlight=777620&bgColorError=fddfdf&bgTextureError=flat&borderColorError=f1a899&fcError=5f3f3f&iconColorError=cc0000&bgColorOverlay=aaaaaa&bgTextureOverlay=flat&bgImgOpacityOverlay=0&opacityOverlay=30&bgColorShadow=666666&bgTextureShadow=flat&bgImgOpacityShadow=0&opacityShadow=30&thicknessShadow=5px&offsetTopShadow=0px&offsetLeftShadow=0px&cornerRadiusShadow=8px
* Copyright jQuery Foundation and other contributors; Licensed MIT */

/* Layout helpers
----------------------------------*/
.ui-helper-hidden {
	display: none;
}
.ui-helper-hidden-accessible {
	border: 0;
	clip: rect(0 0 0 0);
	height: 1px;
	margin: -1px;
	overflow: hidden;
	padding: 0;
	position: absolute;
	width: 1px;
}
.ui-helper-reset {
	margin: 0;
	padding: 0;
	border: 0;
	outline: 0;
	line-height: 1.3;
	text-decoration: none;
	font-size: 100%;
	list-style: none;
}
.ui-helper-clearfix:before,
.ui-helper-clearfix:after {
	content: "";
	display: table;
	border-collapse: collapse;
}
.ui-helper-clearfix:after {
	clear: both;
}
.ui-helper-zfix {
	width: 100%;
	height: 100%;
	top: 0;
	left: 0;
	position: absolute;
	opacity: 0;
	filter:Alpha(Opacity=0); /* support: IE8 */
}

.ui-front {
	z-index: 100;
}


/* Interaction Cues
----------------------------------*/
.ui-state-disabled {
	cursor: default !important;
	pointer-events: none;
}


/* Icons
----------------------------------*/
.ui-icon {
	display: inline-block;
	vertical-align: middle;
	margin-top: -.25em;
	position: relative;
	text-indent: -99999px;
	overflow: hidden;
	background-repeat: no-repeat;
}

.ui-widget-icon-block {
	left: 50%;
	margin-left: -8px;
	display: block;
}

/* Misc visuals
----------------------------------*/

/* Overlays */
.ui-widget-overlay {
	position: fixed;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
}
.ui-accordion .ui-accordion-header {
	display: block;
	cursor: pointer;
	position: relative;
	margin: 2px 0 0 0;
	padding: .5em .5em .5em .7em;
	font-size: 100%;
}
.ui-accordion .ui-accordion-content {
	padding: 1em 2.2em;
	border-top: 0;
	overflow: auto;
}
.ui-autocomplete {
	position: absolute;
	top: 0;
	left: 0;
	cursor: default;
}
.ui-menu {
	list-style: none;
	padding: 0;
	margin: 0;
	display: block;
	outline: 0;
}
.ui-menu .ui-menu {
	position: absolute;
}
.ui-menu .ui-menu-item {
	margin: 0;
	cursor: pointer;
	/* support: IE10, see #8844 */
	list-style-image: url("data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7");
}
.ui-menu .ui-menu-item-wrapper {
	position: relative;
	padding: 3px 1em 3px .4em;
}
.ui-menu .ui-menu-divider {
	margin: 5px 0;
	height: 0;
	font-size: 0;
	line-height: 0;
	border-width: 1px 0 0 0;
}
.ui-menu .ui-state-focus,
.ui-menu .ui-state-active {
	margin: -1px;
}

/* icon support */
.ui-menu-icons {
	position: relative;
}
.ui-menu-icons .ui-menu-item-wrapper {
	padding-left: 2em;
}

/* left-aligned */
.ui-menu .ui-icon {
	position: absolute;
	top: 0;
	bottom: 0;
	left: .2em;
	margin: auto 0;
}

/* right-aligned */
.ui-menu .ui-menu-icon {
	left: auto;
	right: 0;
}
.ui-button {
	padding: .4em 1em;
	display: inline-block;
	position: relative;
	line-height: normal;
	margin-right: .1em;
	cursor: pointer;
	vertical-align: middle;
	text-align: center;
	-webkit-user-select: none;
	-moz-user-select: none;
	-ms-user-select: none;
	user-select: none;

	/* Support: IE <= 11 */
	overflow: visible;
}

.ui-button,
.ui-button:link,
.ui-button:visited,
.ui-button:hover,
.ui-button:active {
	text-decoration: none;
}

/* to make room for the icon, a width needs to be set here */
.ui-button-icon-only {
	width: 2em;
	box-sizing: border-box;
	text-indent: -9999px;
	white-space: nowrap;
}

/* no icon support for input elements */
input.ui-button.ui-button-icon-only {
	text-indent: 0;
}

/* button icon element(s) */
.ui-button-icon-only .ui-icon {
	position: absolute;
	top: 50%;
	left: 50%;
	margin-top: -8px;
	margin-left: -8px;
}

.ui-button.ui-icon-notext .ui-icon {
	padding: 0;
	width: 2.1em;
	height: 2.1em;
	text-indent: -9999px;
	white-space: nowrap;

}

input.ui-button.ui-icon-notext .ui-icon {
	width: auto;
	height: auto;
	text-indent: 0;
	white-space: normal;
	padding: .4em 1em;
}

/* workarounds */
/* Support: Firefox 5 - 40 */
input.ui-button::-moz-focus-inner,
button.ui-button::-moz-focus-inner {
	border: 0;
	padding: 0;
}
.ui-controlgroup {
	vertical-align: middle;
	display: inline-block;
}
.ui-controlgroup > .ui-controlgroup-item {
	float: left;
	margin-left: 0;
	margin-right: 0;
}
.ui-controlgroup > .ui-controlgroup-item:focus,
.ui-controlgroup > .ui-controlgroup-item.ui-visual-focus {
	z-index: 9999;
}
.ui-controlgroup-vertical > .ui-controlgroup-item {
	display: block;
	float: none;
	width: 100%;
	margin-top: 0;
	margin-bottom: 0;
	text-align: left;
}
.ui-controlgroup-vertical .ui-controlgroup-item {
	box-sizing: border-box;
}
.ui-controlgroup .ui-controlgroup-label {
	padding: .4em 1em;
}
.ui-controlgroup .ui-controlgroup-label span {
	font-size: 80%;
}
.ui-controlgroup-horizontal .ui-controlgroup-label + .ui-controlgroup-item {
	border-left: none;
}
.ui-controlgroup-vertical .ui-controlgroup-label + .ui-controlgroup-item {
	border-top: none;
}
.ui-controlgroup-horizontal .ui-controlgroup-label.ui-widget-content {
	border-right: none;
}
.ui-controlgroup-vertical .ui-controlgroup-label.ui-widget-content {
	border-bottom: none;
}

/* Spinner specific style fixes */
.ui-controlgroup-vertical .ui-spinner-input {

	/* Support: IE8 only, Android < 4.4 only */
	width: 75%;
	width: calc( 100% - 2.4em );
}
.ui-controlgroup-vertical .ui-spinner .ui-spinner-up {
	border-top-style: solid;
}

.ui-checkboxradio-label .ui-icon-background {
	box-shadow: inset 1px 1px 1px #ccc;
	border-radius: .12em;
	border: none;
}
.ui-checkboxradio-radio-label .ui-icon-background {
	width: 16px;
	height: 16px;
	border-radius: 1em;
	overflow: visible;
	border: none;
}
.ui-checkboxradio-radio-label.ui-checkboxradio-checked .ui-icon,
.ui-checkboxradio-radio-label.ui-checkboxradio-checked:hover .ui-icon {
	background-image: none;
	width: 8px;
	height: 8px;
	border-width: 4px;
	border-style: solid;
}
.ui-checkboxradio-disabled {
	pointer-events: none;
}
.ui-datepicker {
	width: 17em;
	padding: .2em .2em 0;
	display: none;
}
.ui-datepicker .ui-datepicker-header {
	position: relative;
	padding: .2em 0;
}
.ui-datepicker .ui-datepicker-prev,
.ui-datepicker .ui-datepicker-next {
	position: absolute;
	top: 2px;
	width: 1.8em;
	height: 1.8em;
}
.ui-datepicker .ui-datepicker-prev-hover,
.ui-datepicker .ui-datepicker-next-hover {
	top: 1px;
}
.ui-datepicker .ui-datepicker-prev {
	left: 2px;
}
.ui-datepicker .ui-datepicker-next {
	right: 2px;
}
.ui-datepicker .ui-datepicker-prev-hover {
	left: 1px;
}
.ui-datepicker .ui-datepicker-next-hover {
	right: 1px;
}
.ui-datepicker .ui-datepicker-prev span,
.ui-datepicker .ui-datepicker-next span {
	display: block;
	position: absolute;
	left: 50%;
	margin-left: -8px;
	top: 50%;
	margin-top: -8px;
}
.ui-datepicker .ui-datepicker-title {
	margin: 0 2.3em;
	line-height: 1.8em;
	text-align: center;
}
.ui-datepicker .ui-datepicker-title select {
	font-size: 1em;
	margin: 1px 0;
}
.ui-datepicker select.ui-datepicker-month,
.ui-datepicker select.ui-datepicker-year {
	width: 45%;
}
.ui-datepicker table {
	width: 100%;
	font-size: .9em;
	border-collapse: collapse;
	margin: 0 0 .4em;
}
.ui-datepicker th {
	padding: .7em .3em;
	text-align: center;
	font-weight: bold;
	border: 0;
}
.ui-datepicker td {
	border: 0;
	padding: 1px;
}
.ui-datepicker td span,
.ui-datepicker td a {
	display: block;
	padding: .2em;
	text-align: right;
	text-decoration: none;
}
.ui-datepicker .ui-datepicker-buttonpane {
	background-image: none;
	margin: .7em 0 0 0;
	padding: 0 .2em;
	border-left: 0;
	border-right: 0;
	border-bottom: 0;
}
.ui-datepicker .ui-datepicker-buttonpane button {
	float: right;
	margin: .5em .2em .4em;
	cursor: pointer;
	padding: .2em .6em .3em .6em;
	width: auto;
	overflow: visible;
}
.ui-datepicker .ui-datepicker-buttonpane button.ui-datepicker-current {
	float: left;
}

/* with multiple calendars */
.ui-datepicker.ui-datepicker-multi {
	width: auto;
}
.ui-datepicker-multi .ui-datepicker-group {
	float: left;
}
.ui-datepicker-multi .ui-datepicker-group table {
	width: 95%;
	margin: 0 auto .4em;
}
.ui-datepicker-multi-2 .ui-datepicker-group {
	width: 50%;
}
.ui-datepicker-multi-3 .ui-datepicker-group {
	width: 33.3%;
}
.ui-datepicker-multi-4 .ui-datepicker-group {
	width: 25%;
}
.ui-datepicker-multi .ui-datepicker-group-last .ui-datepicker-header,
.ui-datepicker-multi .ui-datepicker-group-middle .ui-datepicker-header {
	border-left-width: 0;
}
.ui-datepicker-multi .ui-datepicker-buttonpane {
	clear: left;
}
.ui-datepicker-row-break {
	clear: both;
	width: 100%;
	font-size: 0;
}

/* RTL support */
.ui-datepicker-rtl {
	direction: rtl;
}
.ui-datepicker-rtl .ui-datepicker-prev {
	right: 2px;
	left: auto;
}
.ui-datepicker-rtl .ui-datepicker-next {
	left: 2px;
	right: auto;
}
.ui-datepicker-rtl .ui-datepicker-prev:hover {
	right: 1px;
	left: auto;
}
.ui-datepicker-rtl .ui-datepicker-next:hover {
	left: 1px;
	right: auto;
}
.ui-datepicker-rtl .ui-datepicker-buttonpane {
	clear: right;
}
.ui-datepicker-rtl .ui-datepicker-buttonpane button {
	float: left;
}
.ui-datepicker-rtl .ui-datepicker-buttonpane button.ui-datepicker-current,
.ui-datepicker-rtl .ui-datepicker-group {
	float: right;
}
.ui-datepicker-rtl .ui-datepicker-group-last .ui-datepicker-header,
.ui-datepicker-rtl .ui-datepicker-group-middle .ui-datepicker-header {
	border-right-width: 0;
	border-left-width: 1px;
}

/* Icons */
.ui-datepicker .ui-icon {
	display: block;
	text-indent: -99999px;
	overflow: hidden;
	background-repeat: no-repeat;
	left: .5em;
	top: .3em;
}
.ui-dialog {
	position: absolute;
	top: 0;
	left: 0;
	padding: .2em;
	outline: 0;
}
.ui-dialog .ui-dialog-titlebar {
	padding: .4em 1em;
	position: relative;
}
.ui-dialog .ui-dialog-title {
	float: left;
	margin: .1em 0;
	white-space: nowrap;
	width: 90%;
	overflow: hidden;
	text-overflow: ellipsis;
}
.ui-dialog .ui-dialog-titlebar-close {
	position: absolute;
	right: .3em;
	top: 50%;
	width: 20px;
	margin: -10px 0 0 0;
	padding: 1px;
	height: 20px;
}
.ui-dialog .ui-dialog-content {
	position: relative;
	border: 0;
	padding: .5em 1em;
	background: none;
	overflow: auto;
}
.ui-dialog .ui-dialog-buttonpane {
	text-align: left;
	border-width: 1px 0 0 0;
	background-image: none;
	margin-top: .5em;
	padding: .3em 1em .5em .4em;
}
.ui-dialog .ui-dialog-buttonpane .ui-dialog-buttonset {
	float: right;
}
.ui-dialog .ui-dialog-buttonpane button {
	margin: .5em .4em .5em 0;
	cursor: pointer;
}
.ui-dialog .ui-resizable-n {
	height: 2px;
	top: 0;
}
.ui-dialog .ui-resizable-e {
	width: 2px;
	right: 0;
}
.ui-dialog .ui-resizable-s {
	height: 2px;
	bottom: 0;
}
.ui-dialog .ui-resizable-w {
	width: 2px;
	left: 0;
}
.ui-dialog .ui-resizable-se,
.ui-dialog .ui-resizable-sw,
.ui-dialog .ui-resizable-ne,
.ui-dialog .ui-resizable-nw {
	width: 7px;
	height: 7px;
}
.ui-dialog .ui-resizable-se {
	right: 0;
	bottom: 0;
}
.ui-dialog .ui-resizable-sw {
	left: 0;
	bottom: 0;
}
.ui-dialog .ui-resizable-ne {
	right: 0;
	top: 0;
}
.ui-dialog .ui-resizable-nw {
	left: 0;
	top: 0;
}
.ui-draggable .ui-dialog-titlebar {
	cursor: move;
}
.ui-draggable-handle {
	-ms-touch-action: none;
	touch-action: none;
}
.ui-resizable {
	position: relative;
}
.ui-resizable-handle {
	position: absolute;
	font-size: 0.1px;
	display: block;
	-ms-touch-action: none;
	touch-action: none;
}
.ui-resizable-disabled .ui-resizable-handle,
.ui-resizable-autohide .ui-resizable-handle {
	display: none;
}
.ui-resizable-n {
	cursor: n-resize;
	height: 7px;
	width: 100%;
	top: -5px;
	left: 0;
}
.ui-resizable-s {
	cursor: s-resize;
	height: 7px;
	width: 100%;
	bottom: -5px;
	left: 0;
}
.ui-resizable-e {
	cursor: e-resize;
	width: 7px;
	right: -5px;
	top: 0;
	height: 100%;
}
.ui-resizable-w {
	cursor: w-resize;
	width: 7px;
	left: -5px;
	top: 0;
	height: 100%;
}
.ui-resizable-se {
	cursor: se-resize;
	width: 12px;
	height: 12px;
	right: 1px;
	bottom: 1px;
}
.ui-resizable-sw {
	cursor: sw-resize;
	width: 9px;
	height: 9px;
	left: -5px;
	bottom: -5px;
}
.ui-resizable-nw {
	cursor: nw-resize;
	width: 9px;
	height: 9px;
	left: -5px;
	top: -5px;
}
.ui-resizable-ne {
	cursor: ne-resize;
	width: 9px;
	height: 9px;
	right: -5px;
	top: -5px;
}
.ui-progressbar {
	height: 2em;
	text-align: left;
	overflow: hidden;
}
.ui-progressbar .ui-progressbar-value {
	margin: -1px;
	height: 100%;
}
.ui-progressbar .ui-progressbar-overlay {
	background: url("data:image/gif;base64,R0lGODlhKAAoAIABAAAAAP///yH/C05FVFNDQVBFMi4wAwEAAAAh+QQJAQABACwAAAAAKAAoAAACkYwNqXrdC52DS06a7MFZI+4FHBCKoDeWKXqymPqGqxvJrXZbMx7Ttc+w9XgU2FB3lOyQRWET2IFGiU9m1frDVpxZZc6bfHwv4c1YXP6k1Vdy292Fb6UkuvFtXpvWSzA+HycXJHUXiGYIiMg2R6W459gnWGfHNdjIqDWVqemH2ekpObkpOlppWUqZiqr6edqqWQAAIfkECQEAAQAsAAAAACgAKAAAApSMgZnGfaqcg1E2uuzDmmHUBR8Qil95hiPKqWn3aqtLsS18y7G1SzNeowWBENtQd+T1JktP05nzPTdJZlR6vUxNWWjV+vUWhWNkWFwxl9VpZRedYcflIOLafaa28XdsH/ynlcc1uPVDZxQIR0K25+cICCmoqCe5mGhZOfeYSUh5yJcJyrkZWWpaR8doJ2o4NYq62lAAACH5BAkBAAEALAAAAAAoACgAAAKVDI4Yy22ZnINRNqosw0Bv7i1gyHUkFj7oSaWlu3ovC8GxNso5fluz3qLVhBVeT/Lz7ZTHyxL5dDalQWPVOsQWtRnuwXaFTj9jVVh8pma9JjZ4zYSj5ZOyma7uuolffh+IR5aW97cHuBUXKGKXlKjn+DiHWMcYJah4N0lYCMlJOXipGRr5qdgoSTrqWSq6WFl2ypoaUAAAIfkECQEAAQAsAAAAACgAKAAAApaEb6HLgd/iO7FNWtcFWe+ufODGjRfoiJ2akShbueb0wtI50zm02pbvwfWEMWBQ1zKGlLIhskiEPm9R6vRXxV4ZzWT2yHOGpWMyorblKlNp8HmHEb/lCXjcW7bmtXP8Xt229OVWR1fod2eWqNfHuMjXCPkIGNileOiImVmCOEmoSfn3yXlJWmoHGhqp6ilYuWYpmTqKUgAAIfkECQEAAQAsAAAAACgAKAAAApiEH6kb58biQ3FNWtMFWW3eNVcojuFGfqnZqSebuS06w5V80/X02pKe8zFwP6EFWOT1lDFk8rGERh1TTNOocQ61Hm4Xm2VexUHpzjymViHrFbiELsefVrn6XKfnt2Q9G/+Xdie499XHd2g4h7ioOGhXGJboGAnXSBnoBwKYyfioubZJ2Hn0RuRZaflZOil56Zp6iioKSXpUAAAh+QQJAQABACwAAAAAKAAoAAACkoQRqRvnxuI7kU1a1UU5bd5tnSeOZXhmn5lWK3qNTWvRdQxP8qvaC+/yaYQzXO7BMvaUEmJRd3TsiMAgswmNYrSgZdYrTX6tSHGZO73ezuAw2uxuQ+BbeZfMxsexY35+/Qe4J1inV0g4x3WHuMhIl2jXOKT2Q+VU5fgoSUI52VfZyfkJGkha6jmY+aaYdirq+lQAACH5BAkBAAEALAAAAAAoACgAAAKWBIKpYe0L3YNKToqswUlvznigd4wiR4KhZrKt9Upqip61i9E3vMvxRdHlbEFiEXfk9YARYxOZZD6VQ2pUunBmtRXo1Lf8hMVVcNl8JafV38aM2/Fu5V16Bn63r6xt97j09+MXSFi4BniGFae3hzbH9+hYBzkpuUh5aZmHuanZOZgIuvbGiNeomCnaxxap2upaCZsq+1kAACH5BAkBAAEALAAAAAAoACgAAAKXjI8By5zf4kOxTVrXNVlv1X0d8IGZGKLnNpYtm8Lr9cqVeuOSvfOW79D9aDHizNhDJidFZhNydEahOaDH6nomtJjp1tutKoNWkvA6JqfRVLHU/QUfau9l2x7G54d1fl995xcIGAdXqMfBNadoYrhH+Mg2KBlpVpbluCiXmMnZ2Sh4GBqJ+ckIOqqJ6LmKSllZmsoq6wpQAAAh+QQJAQABACwAAAAAKAAoAAAClYx/oLvoxuJDkU1a1YUZbJ59nSd2ZXhWqbRa2/gF8Gu2DY3iqs7yrq+xBYEkYvFSM8aSSObE+ZgRl1BHFZNr7pRCavZ5BW2142hY3AN/zWtsmf12p9XxxFl2lpLn1rseztfXZjdIWIf2s5dItwjYKBgo9yg5pHgzJXTEeGlZuenpyPmpGQoKOWkYmSpaSnqKileI2FAAACH5BAkBAAEALAAAAAAoACgAAAKVjB+gu+jG4kORTVrVhRlsnn2dJ3ZleFaptFrb+CXmO9OozeL5VfP99HvAWhpiUdcwkpBH3825AwYdU8xTqlLGhtCosArKMpvfa1mMRae9VvWZfeB2XfPkeLmm18lUcBj+p5dnN8jXZ3YIGEhYuOUn45aoCDkp16hl5IjYJvjWKcnoGQpqyPlpOhr3aElaqrq56Bq7VAAAOw==");
	height: 100%;
	filter: alpha(opacity=25); /* support: IE8 */
	opacity: 0.25;
}
.ui-progressbar-indeterminate .ui-progressbar-value {
	background-image: none;
}
.ui-selectable {
	-ms-touch-action: none;
	touch-action: none;
}
.ui-selectable-helper {
	position: absolute;
	z-index: 100;
	border: 1px dotted black;
}
.ui-selectmenu-menu {
	padding: 0;
	margin: 0;
	position: absolute;
	top: 0;
	left: 0;
	display: none;
}
.ui-selectmenu-menu .ui-menu {
	overflow: auto;
	overflow-x: hidden;
	padding-bottom: 1px;
}
.ui-selectmenu-menu .ui-menu .ui-selectmenu-optgroup {
	font-size: 1em;
	font-weight: bold;
	line-height: 1.5;
	padding: 2px 0.4em;
	margin: 0.5em 0 0 0;
	height: auto;
	border: 0;
}
.ui-selectmenu-open {
	display: block;
}
.ui-selectmenu-text {
	display: block;
	margin-right: 20px;
	overflow: hidden;
	text-overflow: ellipsis;
}
.ui-selectmenu-button.ui-button {
	text-align: left;
	white-space: nowrap;
	width: 14em;
}
.ui-selectmenu-icon.ui-icon {
	float: right;
	margin-top: 0;
}
.ui-slider {
	position: relative;
	text-align: left;
}
.ui-slider .ui-slider-handle {
	position: absolute;
	z-index: 2;
	width: 1.2em;
	height: 1.2em;
	cursor: default;
	-ms-touch-action: none;
	touch-action: none;
}
.ui-slider .ui-slider-range {
	position: absolute;
	z-index: 1;
	font-size: .7em;
	display: block;
	border: 0;
	background-position: 0 0;
}

/* support: IE8 - See #6727 */
.ui-slider.ui-state-disabled .ui-slider-handle,
.ui-slider.ui-state-disabled .ui-slider-range {
	filter: inherit;
}

.ui-slider-horizontal {
	height: .8em;
}
.ui-slider-horizontal .ui-slider-handle {
	top: -.3em;
	margin-left: -.6em;
}
.ui-slider-horizontal .ui-slider-range {
	top: 0;
	height: 100%;
}
.ui-slider-horizontal .ui-slider-range-min {
	left: 0;
}
.ui-slider-horizontal .ui-slider-range-max {
	right: 0;
}

.ui-slider-vertical {
	width: .8em;
	height: 100px;
}
.ui-slider-vertical .ui-slider-handle {
	left: -.3em;
	margin-left: 0;
	margin-bottom: -.6em;
}
.ui-slider-vertical .ui-slider-range {
	left: 0;
	width: 100%;
}
.ui-slider-vertical .ui-slider-range-min {
	bottom: 0;
}
.ui-slider-vertical .ui-slider-range-max {
	top: 0;
}
.ui-sortable-handle {
	-ms-touch-action: none;
	touch-action: none;
}
.ui-spinner {
	position: relative;
	display: inline-block;
	overflow: hidden;
	padding: 0;
	vertical-align: middle;
}
.ui-spinner-input {
	border: none;
	background: none;
	color: inherit;
	padding: .222em 0;
	margin: .2em 0;
	vertical-align: middle;
	margin-left: .4em;
	margin-right: 2em;
}
.ui-spinner-button {
	width: 1.6em;
	height: 50%;
	font-size: .5em;
	padding: 0;
	margin: 0;
	text-align: center;
	position: absolute;
	cursor: default;
	display: block;
	overflow: hidden;
	right: 0;
}
/* more specificity required here to override default borders */
.ui-spinner a.ui-spinner-button {
	border-top-style: none;
	border-bottom-style: none;
	border-right-style: none;
}
.ui-spinner-up {
	top: 0;
}
.ui-spinner-down {
	bottom: 0;
}
.ui-tabs {
	position: relative;/* position: relative prevents IE scroll bug (element with position: relative inside container with overflow: auto appear as "fixed") */
	padding: .2em;
}
.ui-tabs .ui-tabs-nav {
	margin: 0;
	padding: .2em .2em 0;
}
.ui-tabs .ui-tabs-nav li {
	list-style: none;
	float: left;
	position: relative;
	top: 0;
	margin: 1px .2em 0 0;
	border-bottom-width: 0;
	padding: 0;
	white-space: nowrap;
}
.ui-tabs .ui-tabs-nav .ui-tabs-anchor {
	float: left;
	padding: .5em 1em;
	text-decoration: none;
}
.ui-tabs .ui-tabs-nav li.ui-tabs-active {
	margin-bottom: -1px;
	padding-bottom: 1px;
}
.ui-tabs .ui-tabs-nav li.ui-tabs-active .ui-tabs-anchor,
.ui-tabs .ui-tabs-nav li.ui-state-disabled .ui-tabs-anchor,
.ui-tabs .ui-tabs-nav li.ui-tabs-loading .ui-tabs-anchor {
	cursor: text;
}
.ui-tabs-collapsible .ui-tabs-nav li.ui-tabs-active .ui-tabs-anchor {
	cursor: pointer;
}
.ui-tabs .ui-tabs-panel {
	display: block;
	border-width: 0;
	padding: 1em 1.4em;
	background: none;
}
.ui-tooltip {
	padding: 8px;
	position: absolute;
	z-index: 9999;
	max-width: 300px;
}
body .ui-tooltip {
	border-width: 2px;
}
/* Component containers
----------------------------------*/
.ui-widget {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 1em;
}
.ui-widget .ui-widget {
	font-size: 1em;
}
.ui-widget input,
.ui-widget select,
.ui-widget textarea,
.ui-widget button {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 1em;
}
.ui-widget.ui-widget-content {
	border: 1px solid #c5c5c5;
}
.ui-widget-content {
	border: 1px solid #dddddd;
	background: #ffffff;
	color: #333333;
}
.ui-widget-content a {
	color: #333333;
}
.ui-widget-header {
	border: 1px solid #dddddd;
	background: #e9e9e9;
	color: #333333;
	font-weight: bold;
}
.ui-widget-header a {
	color: #333333;
}

/* Interaction states
----------------------------------*/
.ui-state-default,
.ui-widget-content .ui-state-default,
.ui-widget-header .ui-state-default,
.ui-button,

/* We use html here because we need a greater specificity to make sure disabled
works properly when clicked or hovered */
html .ui-button.ui-state-disabled:hover,
html .ui-button.ui-state-disabled:active {
	border: 1px solid #c5c5c5;
	background: #f6f6f6;
	font-weight: normal;
	color: #454545;
}
.ui-state-default a,
.ui-state-default a:link,
.ui-state-default a:visited,
a.ui-button,
a:link.ui-button,
a:visited.ui-button,
.ui-button {
	color: #454545;
	text-decoration: none;
}
.ui-state-hover,
.ui-widget-content .ui-state-hover,
.ui-widget-header .ui-state-hover,
.ui-state-focus,
.ui-widget-content .ui-state-focus,
.ui-widget-header .ui-state-focus,
.ui-button:hover,
.ui-button:focus {
	border: 1px solid #cccccc;
	background: #ededed;
	font-weight: normal;
	color: #2b2b2b;
}
.ui-state-hover a,
.ui-state-hover a:hover,
.ui-state-hover a:link,
.ui-state-hover a:visited,
.ui-state-focus a,
.ui-state-focus a:hover,
.ui-state-focus a:link,
.ui-state-focus a:visited,
a.ui-button:hover,
a.ui-button:focus {
	color: #2b2b2b;
	text-decoration: none;
}

.ui-visual-focus {
	box-shadow: 0 0 3px 1px rgb(94, 158, 214);
}
.ui-state-active,
.ui-widget-content .ui-state-active,
.ui-widget-header .ui-state-active,
a.ui-button:active,
.ui-button:active,
.ui-button.ui-state-active:hover {
	border: 1px solid #003eff;
	background: #007fff;
	font-weight: normal;
	color: #ffffff;
}
.ui-icon-background,
.ui-state-active .ui-icon-background {
	border: #003eff;
	background-color: #ffffff;
}
.ui-state-active a,
.ui-state-active a:link,
.ui-state-active a:visited {
	color: #ffffff;
	text-decoration: none;
}

/* Interaction Cues
----------------------------------*/
.ui-state-highlight,
.ui-widget-content .ui-state-highlight,
.ui-widget-header .ui-state-highlight {
	border: 1px solid #dad55e;
	background: #fffa90;
	color: #777620;
}
.ui-state-checked {
	border: 1px solid #dad55e;
	background: #fffa90;
}
.ui-state-highlight a,
.ui-widget-content .ui-state-highlight a,
.ui-widget-header .ui-state-highlight a {
	color: #777620;
}
.ui-state-error,
.ui-widget-content .ui-state-error,
.ui-widget-header .ui-state-error {
	border: 1px solid #f1a899;
	background: #fddfdf;
	color: #5f3f3f;
}
.ui-state-error a,
.ui-widget-content .ui-state-error a,
.ui-widget-header .ui-state-error a {
	color: #5f3f3f;
}
.ui-state-error-text,
.ui-widget-content .ui-state-error-text,
.ui-widget-header .ui-state-error-text {
	color: #5f3f3f;
}
.ui-priority-primary,
.ui-widget-content .ui-priority-primary,
.ui-widget-header .ui-priority-primary {
	font-weight: bold;
}
.ui-priority-secondary,
.ui-widget-content .ui-priority-secondary,
.ui-widget-header .ui-priority-secondary {
	opacity: .7;
	filter:Alpha(Opacity=70); /* support: IE8 */
	font-weight: normal;
}
.ui-state-disabled,
.ui-widget-content .ui-state-disabled,
.ui-widget-header .ui-state-disabled {
	opacity: .35;
	filter:Alpha(Opacity=35); /* support: IE8 */
	background-image: none;
}
.ui-state-disabled .ui-icon {
	filter:Alpha(Opacity=35); /* support: IE8 - See #6059 */
}

/* Icons
----------------------------------*/

/* states and images */
.ui-icon {
	width: 16px;
	height: 16px;
}
.ui-icon,
.ui-widget-content .ui-icon {
	background-image: url("images/ui-icons_444444_256x240.png");
}
.ui-widget-header .ui-icon {
	background-image: url("images/ui-icons_444444_256x240.png");
}
.ui-state-hover .ui-icon,
.ui-state-focus .ui-icon,
.ui-button:hover .ui-icon,
.ui-button:focus .ui-icon {
	background-image: url("images/ui-icons_555555_256x240.png");
}
.ui-state-active .ui-icon,
.ui-button:active .ui-icon {
	background-image: url("images/ui-icons_ffffff_256x240.png");
}
.ui-state-highlight .ui-icon,
.ui-button .ui-state-highlight.ui-icon {
	background-image: url("images/ui-icons_777620_256x240.png");
}
.ui-state-error .ui-icon,
.ui-state-error-text .ui-icon {
	background-image: url("images/ui-icons_cc0000_256x240.png");
}
.ui-button .ui-icon {
	background-image: url("images/ui-icons_777777_256x240.png");
}

/* positioning */
.ui-icon-blank { background-position: 16px 16px; }
.ui-icon-caret-1-n { background-position: 0 0; }
.ui-icon-caret-1-ne { background-position: -16px 0; }
.ui-icon-caret-1-e { background-position: -32px 0; }
.ui-icon-caret-1-se { background-position: -48px 0; }
.ui-icon-caret-1-s { background-position: -65px 0; }
.ui-icon-caret-1-sw { background-position: -80px 0; }
.ui-icon-caret-1-w { background-position: -96px 0; }
.ui-icon-caret-1-nw { background-position: -112px 0; }
.ui-icon-caret-2-n-s { background-position: -128px 0; }
.ui-icon-caret-2-e-w { background-position: -144px 0; }
.ui-icon-triangle-1-n { background-position: 0 -16px; }
.ui-icon-triangle-1-ne { background-position: -16px -16px; }
.ui-icon-triangle-1-e { background-position: -32px -16px; }
.ui-icon-triangle-1-se { background-position: -48px -16px; }
.ui-icon-triangle-1-s { background-position: -65px -16px; }
.ui-icon-triangle-1-sw { background-position: -80px -16px; }
.ui-icon-triangle-1-w { background-position: -96px -16px; }
.ui-icon-triangle-1-nw { background-position: -112px -16px; }
.ui-icon-triangle-2-n-s { background-position: -128px -16px; }
.ui-icon-triangle-2-e-w { background-position: -144px -16px; }
.ui-icon-arrow-1-n { background-position: 0 -32px; }
.ui-icon-arrow-1-ne { background-position: -16px -32px; }
.ui-icon-arrow-1-e { background-position: -32px -32px; }
.ui-icon-arrow-1-se { background-position: -48px -32px; }
.ui-icon-arrow-1-s { background-position: -65px -32px; }
.ui-icon-arrow-1-sw { background-position: -80px -32px; }
.ui-icon-arrow-1-w { background-position: -96px -32px; }
.ui-icon-arrow-1-nw { background-position: -112px -32px; }
.ui-icon-arrow-2-n-s { background-position: -128px -32px; }
.ui-icon-arrow-2-ne-sw { background-position: -144px -32px; }
.ui-icon-arrow-2-e-w { background-position: -160px -32px; }
.ui-icon-arrow-2-se-nw { background-position: -176px -32px; }
.ui-icon-arrowstop-1-n { background-position: -192px -32px; }
.ui-icon-arrowstop-1-e { background-position: -208px -32px; }
.ui-icon-arrowstop-1-s { background-position: -224px -32px; }
.ui-icon-arrowstop-1-w { background-position: -240px -32px; }
.ui-icon-arrowthick-1-n { background-position: 1px -48px; }
.ui-icon-arrowthick-1-ne { background-position: -16px -48px; }
.ui-icon-arrowthick-1-e { background-position: -32px -48px; }
.ui-icon-arrowthick-1-se { background-position: -48px -48px; }
.ui-icon-arrowthick-1-s { background-position: -64px -48px; }
.ui-icon-arrowthick-1-sw { background-position: -80px -48px; }
.ui-icon-arrowthick-1-w { background-position: -96px -48px; }
.ui-icon-arrowthick-1-nw { background-position: -112px -48px; }
.ui-icon-arrowthick-2-n-s { background-position: -128px -48px; }
.ui-icon-arrowthick-2-ne-sw { background-position: -144px -48px; }
.ui-icon-arrowthick-2-e-w { background-position: -160px -48px; }
.ui-icon-arrowthick-2-se-nw { background-position: -176px -48px; }
.ui-icon-arrowthickstop-1-n { background-position: -192px -48px; }
.ui-icon-arrowthickstop-1-e { background-position: -208px -48px; }
.ui-icon-arrowthickstop-1-s { background-position: -224px -48px; }
.ui-icon-arrowthickstop-1-w { background-position: -240px -48px; }
.ui-icon-arrowreturnthick-1-w { background-position: 0 -64px; }
.ui-icon-arrowreturnthick-1-n { background-position: -16px -64px; }
.ui-icon-arrowreturnthick-1-e { background-position: -32px -64px; }
.ui-icon-arrowreturnthick-1-s { background-position: -48px -64px; }
.ui-icon-arrowreturn-1-w { background-position: -64px -64px; }
.ui-icon-arrowreturn-1-n { background-position: -80px -64px; }
.ui-icon-arrowreturn-1-e { background-position: -96px -64px; }
.ui-icon-arrowreturn-1-s { background-position: -112px -64px; }
.ui-icon-arrowrefresh-1-w { background-position: -128px -64px; }
.ui-icon-arrowrefresh-1-n { background-position: -144px -64px; }
.ui-icon-arrowrefresh-1-e { background-position: -160px -64px; }
.ui-icon-arrowrefresh-1-s { background-position: -176px -64px; }
.ui-icon-arrow-4 { background-position: 0 -80px; }
.ui-icon-arrow-4-diag { background-position: -16px -80px; }
.ui-icon-extlink { background-position: -32px -80px; }
.ui-icon-newwin { background-position: -48px -80px; }
.ui-icon-refresh { background-position: -64px -80px; }
.ui-icon-shuffle { background-position: -80px -80px; }
.ui-icon-transfer-e-w { background-position: -96px -80px; }
.ui-icon-transferthick-e-w { background-position: -112px -80px; }
.ui-icon-folder-collapsed { background-position: 0 -96px; }
.ui-icon-folder-open { background-position: -16px -96px; }
.ui-icon-document { background-position: -32px -96px; }
.ui-icon-document-b { background-position: -48px -96px; }
.ui-icon-note { background-position: -64px -96px; }
.ui-icon-mail-closed { background-position: -80px -96px; }
.ui-icon-mail-open { background-position: -96px -96px; }
.ui-icon-suitcase { background-position: -112px -96px; }
.ui-icon-comment { background-position: -128px -96px; }
.ui-icon-person { background-position: -144px -96px; }
.ui-icon-print { background-position: -160px -96px; }
.ui-icon-trash { background-position: -176px -96px; }
.ui-icon-locked { background-position: -192px -96px; }
.ui-icon-unlocked { background-position: -208px -96px; }
.ui-icon-bookmark { background-position: -224px -96px; }
.ui-icon-tag { background-position: -240px -96px; }
.ui-icon-home { background-position: 0 -112px; }
.ui-icon-flag { background-position: -16px -112px; }
.ui-icon-calendar { background-position: -32px -112px; }
.ui-icon-cart { background-position: -48px -112px; }
.ui-icon-pencil { background-position: -64px -112px; }
.ui-icon-clock { background-position: -80px -112px; }
.ui-icon-disk { background-position: -96px -112px; }
.ui-icon-calculator { background-position: -112px -112px; }
.ui-icon-zoomin { background-position: -128px -112px; }
.ui-icon-zoomout { background-position: -144px -112px; }
.ui-icon-search { background-position: -160px -112px; }
.ui-icon-wrench { background-position: -176px -112px; }
.ui-icon-gear { background-position: -192px -112px; }
.ui-icon-heart { background-position: -208px -112px; }
.ui-icon-star { background-position: -224px -112px; }
.ui-icon-link { background-position: -240px -112px; }
.ui-icon-cancel { background-position: 0 -128px; }
.ui-icon-plus { background-position: -16px -128px; }
.ui-icon-plusthick { background-position: -32px -128px; }
.ui-icon-minus { background-position: -48px -128px; }
.ui-icon-minusthick { background-position: -64px -128px; }
.ui-icon-close { background-position: -80px -128px; }
.ui-icon-closethick { background-position: -96px -128px; }
.ui-icon-key { background-position: -112px -128px; }
.ui-icon-lightbulb { background-position: -128px -128px; }
.ui-icon-scissors { background-position: -144px -128px; }
.ui-icon-clipboard { background-position: -160px -128px; }
.ui-icon-copy { background-position: -176px -128px; }
.ui-icon-contact { background-position: -192px -128px; }
.ui-icon-image { background-position: -208px -128px; }
.ui-icon-video { background-position: -224px -128px; }
.ui-icon-script { background-position: -240px -128px; }
.ui-icon-alert { background-position: 0 -144px; }
.ui-icon-info { background-position: -16px -144px; }
.ui-icon-notice { background-position: -32px -144px; }
.ui-icon-help { background-position: -48px -144px; }
.ui-icon-check { background-position: -64px -144px; }
.ui-icon-bullet { background-position: -80px -144px; }
.ui-icon-radio-on { background-position: -96px -144px; }
.ui-icon-radio-off { background-position: -112px -144px; }
.ui-icon-pin-w { background-position: -128px -144px; }
.ui-icon-pin-s { background-position: -144px -144px; }
.ui-icon-play { background-position: 0 -160px; }
.ui-icon-pause { background-position: -16px -160px; }
.ui-icon-seek-next { background-position: -32px -160px; }
.ui-icon-seek-prev { background-position: -48px -160px; }
.ui-icon-seek-end { background-position: -64px -160px; }
.ui-icon-seek-start { background-position: -80px -160px; }
/* ui-icon-seek-first is deprecated, use ui-icon-seek-start instead */
.ui-icon-seek-first { background-position: -80px -160px; }
.ui-icon-stop { background-position: -96px -160px; }
.ui-icon-eject { background-position: -112px -160px; }
.ui-icon-volume-off { background-position: -128px -160px; }
.ui-icon-volume-on { background-position: -144px -160px; }
.ui-icon-power { background-position: 0 -176px; }
.ui-icon-signal-diag { background-position: -16px -176px; }
.ui-icon-signal { background-position: -32px -176px; }
.ui-icon-battery-0 { background-position: -48px -176px; }
.ui-icon-battery-1 { background-position: -64px -176px; }
.ui-icon-battery-2 { background-position: -80px -176px; }
.ui-icon-battery-3 { background-position: -96px -176px; }
.ui-icon-circle-plus { background-position: 0 -192px; }
.ui-icon-circle-minus { background-position: -16px -192px; }
.ui-icon-circle-close { background-position: -32px -192px; }
.ui-icon-circle-triangle-e { background-position: -48px -192px; }
.ui-icon-circle-triangle-s { background-position: -64px -192px; }
.ui-icon-circle-triangle-w { background-position: -80px -192px; }
.ui-icon-circle-triangle-n { background-position: -96px -192px; }
.ui-icon-circle-arrow-e { background-position: -112px -192px; }
.ui-icon-circle-arrow-s { background-position: -128px -192px; }
.ui-icon-circle-arrow-w { background-position: -144px -192px; }
.ui-icon-circle-arrow-n { background-position: -160px -192px; }
.ui-icon-circle-zoomin { background-position: -176px -192px; }
.ui-icon-circle-zoomout { background-position: -192px -192px; }
.ui-icon-circle-check { background-position: -208px -192px; }
.ui-icon-circlesmall-plus { background-position: 0 -208px; }
.ui-icon-circlesmall-minus { background-position: -16px -208px; }
.ui-icon-circlesmall-close { background-position: -32px -208px; }
.ui-icon-squaresmall-plus { background-position: -48px -208px; }
.ui-icon-squaresmall-minus { background-position: -64px -208px; }
.ui-icon-squaresmall-close { background-position: -80px -208px; }
.ui-icon-grip-dotted-vertical { background-position: 0 -224px; }
.ui-icon-grip-dotted-horizontal { background-position: -16px -224px; }
.ui-icon-grip-solid-vertical { background-position: -32px -224px; }
.ui-icon-grip-solid-horizontal { background-position: -48px -224px; }
.ui-icon-gripsmall-diagonal-se { background-position: -64px -224px; }
.ui-icon-grip-diagonal-se { background-position: -80px -224px; }


/* Misc visuals
----------------------------------*/

/* Corner radius */
.ui-corner-all,
.ui-corner-top,
.ui-corner-left,
.ui-corner-tl {
	border-top-left-radius: 3px;
}
.ui-corner-all,
.ui-corner-top,
.ui-corner-right,
.ui-corner-tr {
	border-top-right-radius: 3px;
}
.ui-corner-all,
.ui-corner-bottom,
.ui-corner-left,
.ui-corner-bl {
	border-bottom-left-radius: 3px;
}
.ui-corner-all,
.ui-corner-bottom,
.ui-corner-right,
.ui-corner-br {
	border-bottom-right-radius: 3px;
}

/* Overlays */
.ui-widget-overlay {
	background: #aaaaaa;
	opacity: .3;
	filter: Alpha(Opacity=30); /* support: IE8 */
}
.ui-widget-shadow {
	-webkit-box-shadow: 0px 0px 5px #666666;
	box-shadow: 0px 0px 5px #666666;
}


--pandat69-style.css--

/* Task Board Plugin Styles */

/* Base Container */
.pandat69-container,
div.pandat69-container,
#content .pandat69-container {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif;
    border: 1px solid #ddd;
    padding: 20px;
    margin-bottom: 20px;
    background-color: #f9f9f9;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    box-sizing: border-box;
    color: #384D68;
    position: relative;
    width: 100%;
    max-width: 100%;
}

.pandat69-container *,
.pandat69-container *:before, 
.pandat69-container *:after {
    box-sizing: border-box;
}

/* Header */
.pandat69-container .pandat69-header {
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 1px solid #e0e5eb;
}

.pandat69-container .pandat69-header h2 {
    margin: 0 0 15px 0;
    font-size: 1.5em;
    color: #384D68;
    font-weight: 600;
    line-height: 1.3;
}

/* Controls and Filters */
.pandat69-container .pandat69-controls {
    margin-bottom: 15px;
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

/* Updated filter styles for horizontal layout */
.pandat69-container .pandat69-filters {
    display: flex;
    flex-direction: row; 
    gap: 10px;
    flex-wrap: nowrap; 
    align-items: center;
    margin-bottom: 10px;
}

.pandat69-container .pandat69-filters .pandat69-input,
.pandat69-container .pandat69-filters .pandat69-select {
    flex: 1; 
    min-width: 150px; 
    max-width: 300px; 
}

/* Buttons */
.pandat69-container .pandat69-button,
.pandat69-container .pandat69-icon-button,
.pandat69-container button.pandat69-button,
.pandat69-container button.pandat69-icon-button {
    background-color: #ffffff;
    color: #384D68;
    border: 1px solid #384D68;
    padding: 8px 15px;
    text-decoration: none;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.2s ease;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    line-height: 1.5;
    box-shadow: none;
    font-weight: normal;
    height: auto;
    text-shadow: none;
}

.pandat69-container .pandat69-button:hover,
.pandat69-container .pandat69-icon-button:hover,
.pandat69-container button.pandat69-button:hover,
.pandat69-container button.pandat69-icon-button:hover {
    background-color: #384D68;
    color: #ffffff;
    border-color: #384D68;
}

.pandat69-container .pandat69-icon-button,
.pandat69-container button.pandat69-icon-button {
    padding: 5px 8px;
    line-height: 1;
    min-width: 30px;
    min-height: 30px;
}

.pandat69-container .pandat69-button-danger,
.pandat69-container button.pandat69-button-danger {
    border-color: #d63638;
    color: #d63638;
}

.pandat69-container .pandat69-button-danger:hover,
.pandat69-container button.pandat69-button-danger:hover {
    background-color: #d63638;
    color: #ffffff;
    border-color: #d63638;
}

/* Form Elements */
.pandat69-container .pandat69-input,
.pandat69-container .pandat69-select,
.pandat69-container .pandat69-textarea,
.pandat69-container input[type="text"].pandat69-input,
.pandat69-container input[type="number"].pandat69-input,
.pandat69-container select.pandat69-select,
.pandat69-container textarea.pandat69-textarea {
    padding: 8px 10px;
    border: 1px solid #ccc;
    background-color: #fff;
    font-size: 14px;
    box-sizing: border-box;
    width: 100%;
    color: #384D68;
    line-height: 1.5;
    height: auto;
    min-height: 38px;
    box-shadow: none;
    font-family: inherit;
}

.pandat69-container .pandat69-select,
.pandat69-container select.pandat69-select {
    -webkit-appearance: menulist;
    -moz-appearance: menulist;
    appearance: menulist;
    background-color: #fff;
    height: 38px;
    padding: 5px 10px;
    background-image: none;
    cursor: pointer;
    max-width: 100%;
}

.pandat69-container .pandat69-textarea,
.pandat69-container textarea.pandat69-textarea {
    min-height: 100px;
    resize: vertical;
}

.pandat69-container .pandat69-input:focus,
.pandat69-container .pandat69-select:focus,
.pandat69-container .pandat69-textarea:focus,
.pandat69-container input[type="text"].pandat69-input:focus,
.pandat69-container input[type="number"].pandat69-input:focus,
.pandat69-container select.pandat69-select:focus,
.pandat69-container textarea.pandat69-textarea:focus {
    border-color: #384D68;
    outline: none;
    box-shadow: 0 0 0 1px #384D68;
}

.pandat69-container .pandat69-search-input {
    min-width: 200px;
}

/* Loading State */
.pandat69-container .pandat69-loading {
    text-align: center;
    padding: 20px;
    color: #384D68;
}

/* Task List */
.pandat69-container .pandat69-task-list-container {
    margin-top: 20px;
}

.pandat69-container .pandat69-task-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.pandat69-container .pandat69-task-item {
    background-color: #fff;
    border: 1px solid #e0e5eb;
    margin-bottom: 10px;
    padding: 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    transition: box-shadow 0.2s ease;
    flex-wrap: wrap;
}

.pandat69-container .pandat69-task-item:hover {
    box-shadow: 0 2px 5px rgba(56, 77, 104, 0.1);
}

.pandat69-container .pandat69-task-item-details {
    flex-grow: 1;
    margin-right: 15px;
}

.pandat69-container .pandat69-task-item-name {
    font-weight: bold;
    color: #384D68;
    font-size: 1.1em;
    margin-bottom: 5px;
}

.pandat69-container .pandat69-task-item-meta {
    font-size: 0.9em;
    color: #5d6b7b;
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
}

.pandat69-container .pandat69-task-item-meta span {
    display: inline-block;
}

.pandat69-container .pandat69-task-status {
    display: inline-block;
    padding: 3px 8px;
    font-size: 0.8em;
    color: white !important;
    text-transform: capitalize;
}

.pandat69-container .pandat69-status-pending { background-color: #e9b44c; }
.pandat69-container .pandat69-status-in-progress { background-color: #384D68; }
.pandat69-container .pandat69-status-done { background-color: #3e8d63; }

.pandat69-container .pandat69-task-item-actions {
    display: flex;
    gap: 5px;
    flex-shrink: 0;
}

/* Expandable Sections */
.pandat69-container .pandat69-expandable-section {
    background-color: #fff;
    border: 1px solid #ddd;
    margin-bottom: 20px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    overflow: hidden;
    transition: all 0.3s ease;
}

.pandat69-container .pandat69-expandable-header {
    background-color: #f7f7f7;
    padding: 12px 15px;
    border-bottom: 1px solid #eee;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.pandat69-container .pandat69-expandable-header h3 {
    margin: 0;
    font-size: 1.2em;
    color: #384D68;
    font-weight: 600;
}

.pandat69-container .pandat69-expandable-content {
    padding: 20px 15px;
}

.pandat69-container .pandat69-close-expandable {
    background: none;
    border: none;
    font-size: 22px;
    color: #384D68;
    cursor: pointer;
    padding: 0;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background-color 0.2s;
}

.pandat69-container .pandat69-close-expandable:hover {
    background-color: #eee;
}

/* Task Details Expandable Content */
.pandat69-container .pandat69-task-details-expandable {
    width: 100%;
    background-color: #f9f9f9;
    border-top: 1px dashed #ddd;
    padding: 15px;
    margin-top: 10px;
    display: none;
}

.pandat69-container .pandat69-task-details-content {
    margin-bottom: 20px;
}

.pandat69-container .pandat69-task-details-content h3 {
    margin-top: 0;
    margin-bottom: 15px;
    font-size: 1.3em;
    color: #384D68;
}

.pandat69-container .pandat69-detail-item {
    margin-bottom: 10px;
    line-height: 1.5;
}

.pandat69-container .pandat69-detail-label {
    font-weight: bold;
    color: #384D68;
    min-width: 100px;
    display: inline-block;
}

.pandat69-container .pandat69-detail-value {
    color: #5d6b7b;
}

.pandat69-container .pandat69-task-details-description {
    background-color: #fdfdfd;
    border: 1px solid #eee;
    padding: 15px;
    margin-top: 10px;
    max-height: 300px;
    overflow-y: auto;
}

.pandat69-container .pandat69-task-details-description p:first-child { margin-top: 0; }
.pandat69-container .pandat69-task-details-description p:last-child { margin-bottom: 0; }

.pandat69-container .pandat69-task-details-actions {
    margin-top: 15px;
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

/* Edit Mode Indicator */
.pandat69-container .pandat69-task-item.pandat69-edit-mode {
    border-color: #384D68;
    box-shadow: 0 0 0 1px #384D68;
}

/* Comments */
.pandat69-container .pandat69-task-comments {
    margin-top: 20px;
    padding-top: 15px;
    border-top: 1px solid #eee;
}

.pandat69-container .pandat69-task-comments h4 {
    margin-top: 0;
    margin-bottom: 15px;
    font-size: 1.1em;
    color: #384D68;
}

.pandat69-container .pandat69-comment-list {
    list-style: none;
    padding: 0;
    margin: 0 0 15px 0;
    max-height: 300px;
    overflow-y: auto;
}

.pandat69-container .pandat69-comment-item {
    margin-bottom: 15px;
    padding-bottom: 15px;
    border-bottom: 1px dashed #eee;
}

.pandat69-container .pandat69-comment-item:last-child {
    border-bottom: none;
    margin-bottom: 0;
    padding-bottom: 0;
}

.pandat69-container .pandat69-comment-meta {
    font-size: 0.9em;
    color: #5d6b7b;
    margin-bottom: 5px;
}

.pandat69-container .pandat69-comment-author {
    font-weight: bold;
    color: #384D68;
}

.pandat69-container .pandat69-comment-date {
    margin-left: 10px;
}

.pandat69-container .pandat69-comment-text {
    line-height: 1.5;
    color: #384D68;
}

.pandat69-container .pandat69-comment-text p:first-child { margin-top: 0; }
.pandat69-container .pandat69-comment-text p:last-child { margin-bottom: 0; }

.pandat69-container .pandat69-user-mention {
    font-weight: bold;
    color: #384D68;
    text-decoration: none;
}

.pandat69-container .pandat69-user-mention:hover {
    text-decoration: underline;
}

/* Category Management */
.pandat69-container .pandat69-category-list-container {
    max-height: 200px;
    overflow-y: auto;
    margin-bottom: 20px;
    border: 1px solid #eee;
    padding: 10px;
}

.pandat69-container .pandat69-category-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.pandat69-container .pandat69-category-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 5px 0;
    border-bottom: 1px dashed #f0f0f0;
}

.pandat69-container .pandat69-category-item:last-child {
    border-bottom: none;
}

.pandat69-container .pandat69-category-name {
    color: #384D68;
}

.pandat69-container .pandat69-delete-category-btn {
    padding: 3px 6px;
    font-size: 12px;
}

/* Forms */
.pandat69-container .pandat69-form .pandat69-form-field {
    margin-bottom: 15px;
}

.pandat69-container .pandat69-form label {
    display: block;
    margin-bottom: 5px;
    font-weight: 600;
    color: #384D68;
}

.pandat69-container .pandat69-form .pandat69-input,
.pandat69-container .pandat69-form .pandat69-select,
.pandat69-container .pandat69-form .pandat69-textarea {
    width: 100%;
}

.pandat69-container .pandat69-form-row {
    display: flex;
    gap: 20px;
    margin-bottom: 15px;
}

.pandat69-container .pandat69-form-field-half {
    flex: 1;
    min-width: 0;
}

.pandat69-container .pandat69-form .pandat69-description {
    font-size: 0.85em;
    color: #5d6b7b;
    margin-top: 5px;
}

.pandat69-container .pandat69-form-actions {
    margin-top: 20px;
    display: flex;
    align-items: center;
    gap: 15px;
    flex-wrap: wrap;
}

.pandat69-container .pandat69-form-message {
    font-size: 0.9em;
    padding: 8px;
}

.pandat69-container .pandat69-form-message.pandat69-success {
    color: #3e8d63;
    background-color: #d4edda;
    border: 1px solid #c3e6cb;
}

.pandat69-container .pandat69-form-message.pandat69-error {
    color: #d63638;
    background-color: #f8d7da;
    border: 1px solid #f5c6cb;
}

/* TinyMCE Specific Styles */
.pandat69-container .mce-tinymce {
    border: 1px solid #ccc !important;
}

.pandat69-container .mce-panel {
    background-color: #f7f7f7 !important;
    border-color: #ccc !important;
}

.pandat69-container .mce-btn {
    background-color: transparent !important;
    border-color: transparent !important;
}

.pandat69-container .mce-btn:hover, 
.pandat69-container .mce-btn:focus {
    background-color: #eee !important;
    border-color: #ccc !important;
}

.pandat69-container .mce-toolbar .mce-btn button {
    padding: 4px !important;
    color: #384D68 !important;
}

/* User Autocomplete */
.pandat69-container .pandat69-user-autocomplete-container {
    position: relative;
}

.pandat69-container .pandat69-user-search-input {
    width: 100%;
    margin-bottom: 8px;
}

.pandat69-container .pandat69-user-suggestions {
    position: absolute;
    left: 0;
    right: 0;
    top: 100%;
    max-height: 200px;
    overflow-y: auto;
    background: #fff;
    border: 1px solid #ddd;
    z-index: 100;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

.pandat69-container .pandat69-user-suggestion-item {
    padding: 8px 12px;
    cursor: pointer;
    border-bottom: 1px solid #f0f0f0;
    color: #384D68;
}

.pandat69-container .pandat69-user-suggestion-item:last-child {
    border-bottom: none;
}

.pandat69-container .pandat69-user-suggestion-item:hover {
    background-color: #f5f5f5;
}

.pandat69-container .pandat69-selected-users-container {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 10px;
}

.pandat69-container .pandat69-selected-user {
    display: inline-flex;
    align-items: center;
    background: #eef2f7;
    border: 1px solid #c0cbd9;
    padding: 4px 10px 4px 12px;
    font-size: 13px;
    cursor: default;
    color: #384D68;
}

.pandat69-container .pandat69-remove-user {
    margin-left: 6px;
    font-weight: bold;
    font-size: 14px;
    color: #5d6b7b;
    cursor: pointer;
}

.pandat69-container .pandat69-remove-user:hover {
    color: #d63638;
}

/* Category Inline Form */
.pandat69-container .pandat69-category-input-group {
    display: flex;
    gap: 5px;
    align-items: center;
}

.pandat69-container .pandat69-category-input-group .pandat69-select {
    flex-grow: 1;
}

.pandat69-container .pandat69-inline-category-form {
    margin-top: 8px;
    padding: 8px;
    background: #f9f9f9;
    border: 1px solid #eee;
}

.pandat69-container .pandat69-inline-form-row {
    display: flex;
    gap: 5px;
    align-items: center;
}

.pandat69-container .pandat69-inline-form-row .pandat69-input {
    flex-grow: 1;
}

.pandat69-container .pandat69-inline-form-row .pandat69-button {
    padding: 6px 10px;
    font-size: 13px;
    height: 38px;
}

.pandat69-container .pandat69-inline-form-message {
    margin-top: 5px;
    font-size: 12px;
    padding: 5px;
}

/* Datepicker Customization */
.pandat69-container .ui-datepicker {
    border: 1px solid #ddd !important;
    padding: 0 !important;
    width: auto !important;
    min-width: 260px !important;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif !important;
    box-shadow: 0 3px 10px rgba(0,0,0,0.16) !important;
    background: #fff !important;
    margin-top: 5px !important;
    z-index: 1001 !important;
}

.pandat69-container .ui-datepicker .ui-datepicker-header {
    border: 0 !important;
    background: #384D68 !important;
    color: #fff !important;
    font-weight: normal !important;
}

.pandat69-container .ui-datepicker .ui-datepicker-title {
    margin: 0 !important;
    padding: 10px 0 !important;
    font-size: 14px !important;
    font-weight: normal !important;
}

.pandat69-container .ui-datepicker th {
    color: #384D68 !important;
    font-weight: 600 !important;
    font-size: 12px !important;
    padding: 7px 0 !important;
    background: #f8f8f8 !important;
}

.pandat69-container .ui-datepicker td {
    padding: 0 !important;
    border: 0 !important;
}

.pandat69-container .ui-datepicker td span, 
.pandat69-container .ui-datepicker td a {
    display: block !important;
    padding: .6em .4em !important;
    text-align: center !important;
    text-decoration: none !important;
    border: 0 !important;
    background: none !important;
    color: #384D68 !important;
    font-size: 13px !important;
}

.pandat69-container .ui-datepicker td a:hover {
    background: #f0f0f0 !important;
}

.pandat69-container .ui-datepicker td a.ui-state-active {
    background: #384D68 !important;
    color: #fff !important;
    font-weight: normal !important;
}

.pandat69-container .ui-datepicker .ui-datepicker-prev,
.pandat69-container .ui-datepicker .ui-datepicker-next {
    position: absolute !important;
    top: 9px !important;
    width: 20px !important;
    height: 20px !important;
    text-indent: -9999px !important;
    cursor: pointer !important;
}

.pandat69-container .ui-datepicker .ui-datepicker-prev {
    left: 10px !important;
}

.pandat69-container .ui-datepicker .ui-datepicker-next {
    right: 10px !important;
}

.pandat69-container .ui-datepicker .ui-datepicker-prev-hover,
.pandat69-container .ui-datepicker .ui-datepicker-next-hover {
    background: transparent !important;
    border: none !important;
    cursor: pointer !important;
}

.pandat69-container .ui-datepicker-today a {
    background-color: #f0f0f0 !important;
    font-weight: bold !important;
}

/* Responsive Adjustments */
@media (max-width: 768px) {
    .pandat69-container .pandat69-form-row {
        flex-direction: column;
        gap: 15px;
        margin-bottom: 0;
    }
    
    .pandat69-container .pandat69-form-field-half {
        margin-bottom: 15px;
    }
    
    .pandat69-container .pandat69-filters {
        flex-direction: column;
        align-items: stretch;
        flex-wrap: wrap;
    }
    
    .pandat69-container .pandat69-filters .pandat69-input,
    .pandat69-container .pandat69-filters .pandat69-select {
        margin-bottom: 10px;
        max-width: none; 
    }
}

@media (max-width: 600px) {
    .pandat69-container {
        padding: 15px 10px;
    }
    
    .pandat69-container .pandat69-task-item {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .pandat69-container .pandat69-task-item-actions {
        margin-top: 10px;
        align-self: flex-end;
    }
    
    .pandat69-container .pandat69-task-item-details {
        margin-right: 0;
        margin-bottom: 10px;
        width: 100%;
    }
    
    .pandat69-container .pandat69-controls {
        flex-direction: column;
        align-items: stretch;
    }
    
    .pandat69-container .pandat69-button {
        width: 100%;
        margin-bottom: 5px;
    }
    
    .pandat69-container .pandat69-task-item-meta {
        flex-direction: column;
        gap: 5px;
    }
    
    .pandat69-container .pandat69-form-actions {
        flex-direction: column;
        align-items: stretch;
    }
    
    .pandat69-container .pandat69-form-actions .pandat69-button {
        width: 100%;
    }
    
    .pandat69-container .pandat69-expandable-content {
        padding: 15px 10px;
    }
}

@media (max-width: 480px) {
    .pandat69-container .ui-datepicker {
        left: 0 !important;
        right: 0 !important;
        width: calc(100% - 20px) !important;
        margin-left: 10px !important;
        margin-right: 10px !important;
    }
    
    .pandat69-container .pandat69-task-details-actions {
        flex-direction: column;
    }
    
    .pandat69-container .pandat69-task-details-actions .pandat69-button {
        width: 100%;
    }
}

.pandat69-container .pandat69-select,
.pandat69-container select.pandat69-select,
.pandat69-container .pandat69-form .pandat69-select {
    -webkit-appearance: menulist;
    -moz-appearance: menulist;
    appearance: menulist;
    background-color: #fff;
    height: 38px;
    padding: 5px 10px;
    color: #384D68;
    font-size: 14px;
    line-height: 1.5;
    vertical-align: middle;
    text-align: left;
    font-family: inherit;
    font-weight: normal;
    cursor: pointer;
    border: 1px solid #ccc;
    width: 100%;
    max-width: 100%;
    text-overflow: ellipsis;
    white-space: nowrap;
    overflow: inherit;
}

/* Firefox specific adjustments */
@-moz-document url-prefix() {
    .pandat69-container .pandat69-select,
    .pandat69-container select.pandat69-select {
        text-indent: 0.01px;
        text-overflow: '';
        padding-right: 25px;
    }
}

/* Safari specific adjustments */
@media screen and (-webkit-min-device-pixel-ratio:0) {
    .pandat69-container .pandat69-select,
    .pandat69-container select.pandat69-select {
        padding-right: 25px;
    }
}

.pandat69-container .pandat69-select option,
.pandat69-container select.pandat69-select option {
    padding: 8px 10px;
    background-color: #fff;
    color: #384D68;
    font-size: 14px;
    line-height: 1.5;
}

.pandat69-container span {
    font-size: inherit;
    line-height: 1.5 !important;
    color: inherit;
    vertical-align: baseline;
    text-align: left !important;
    font-weight: inherit !important;
}

.pandat69-container .pandat69-task-item-meta span {
    font-size: 0.9em;
    color: #384D68;
    line-height: 1.5;
    display: inline-block;
    vertical-align: middle;
}

.pandat69-container .pandat69-detail-label span {
    font-weight: bold;
    color: white;
    line-height: 1.5;
    display: inline-block;
}

.pandat69-container .pandat69-detail-value span {
    color: white;
    line-height: 1.5;
}

.pandat69-container .pandat69-selected-user span {
    vertical-align: middle;
    line-height: 1;
    display: inline-block;
}

/* Status indicators */
.pandat69-container .pandat69-task-status {
    display: inline-block;
    padding: 3px 8px;
    font-size: 0.8em;
    color: white;
    text-transform: capitalize;
    line-height: 1.4;
    vertical-align: middle;
    font-weight: normal;
    text-align: center;
    min-width: 80px;
}

/* Date and user name spans */
.pandat69-container .pandat69-comment-date,
.pandat69-container .pandat69-comment-author {
    line-height: 1.5;
    display: inline-block;
    vertical-align: middle;
}

/* Priority indicators */
.pandat69-container span.pandat69-priority-indicator {
    display: inline-block;
    vertical-align: middle;
    font-weight: normal;
    line-height: 1.4;
}

/* Category name formatting */
.pandat69-container .pandat69-category-name {
    color: #384D68;
    font-size: 14px;
    line-height: 1.5;
    display: inline-block;
    vertical-align: middle;
    text-align: left;
}

/* Emphasized spans (like deadlines or important data) */
.pandat69-container span.pandat69-emphasis {
    font-weight: 600;
    color: #384D68;
}

/* Improved form label text alignment */
.pandat69-container .pandat69-form label span {
    vertical-align: middle;
    line-height: 1.5;
    display: inline-block;
}

/* Fix for spans inside buttons */
.pandat69-container .pandat69-button span,
.pandat69-container button.pandat69-button span {
    line-height: 1.4;
    vertical-align: middle;
    display: inline-block;
}

/* Fix for placeholder text in inputs */
.pandat69-container .pandat69-input::placeholder,
.pandat69-container input[type="text"].pandat69-input::placeholder {
    color: #757575;
    opacity: 1;
    line-height: 1.5;
    font-size: 14px;
    vertical-align: middle;
}

/* Ensure consistent height and vertical centering for all selects */
.pandat69-container .pandat69-select,
.pandat69-container select.pandat69-select,
.pandat69-container .pandat69-filters .pandat69-select {
    height: 38px;
    line-height: 26px; 
    text-align: left;
    padding-top: 5px;
    padding-bottom: 5px;
    box-sizing: border-box;
    vertical-align: middle;
}

/* IE10+ specific styles */
@media all and (-ms-high-contrast: none), (-ms-high-contrast: active) {
    .pandat69-container .pandat69-select,
    .pandat69-container select.pandat69-select {
        padding-top: 0;
        padding-bottom: 0;
        height: 38px;
    }
}
/* @mention autocomplete styles */
.pandat69-mention-dropdown {
    position: absolute;
    background: white;
    border: 1px solid #ddd;
    border-radius: 3px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    z-index: 1000;
    max-height: 200px;
    overflow-y: auto;
    width: auto;
    min-width: 180px;
}

.pandat69-mention-item {
    padding: 8px 12px;
    cursor: pointer;
    border-bottom: 1px solid #f0f0f0;
}

.pandat69-mention-item:hover,
.pandat69-mention-item.active {
    background-color: #f5f5f5;
}

.pandat69-mention-highlight {
    font-weight: bold;
    color: #384D68;
}

/* Style for inserted mentions */
.pandat69-comment-text .pandat69-mention {
    background: #f0f4f8;
    border-radius: 3px;
    padding: 0 3px;
    color: #384D68;
    font-weight: bold;
    text-decoration: none;
}

/* Status Quick Change Dropdown */
.pandat69-container .pandat69-status-dropdown {
    position: absolute;
    background: white;
    border: 1px solid #ddd;
    border-radius: 3px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    z-index: 100;
    margin-top: 5px;
    width: 120px;
}

.pandat69-container .pandat69-status-option {
    padding: 8px 10px;
    cursor: pointer;
    text-align: center;
    color: white;
    transition: opacity 0.2s;
}

.pandat69-container .pandat69-status-option:hover {
    opacity: 0.9;
}

.pandat69-container .pandat69-status-option.pandat69-current-status {
    position: relative;
}

.pandat69-container .pandat69-status-option.pandat69-current-status:after {
    content: "✓";
    position: absolute;
    right: 8px;
    top: 50%;
    transform: translateY(-50%);
}

.pandat69-container .pandat69-status-updated {
    margin-left: 5px;
    animation: fadeOut 2s forwards;
    animation-delay: 1s;
}

@keyframes fadeOut {
    from { opacity: 1; }
    to { opacity: 0; }
}

/* SVG icon styling */
.pandat69-container .pandat69-task-item-meta .pandat69-icon {
    vertical-align: middle;
    margin-right: 5px;
    position: relative;
    top: -1px;
    color: #384D68;
}

/* Ensure strong tags in meta don't mess up the layout */
.pandat69-container .pandat69-task-item-meta strong {
    font-weight: 600;
    margin-right: 3px;
}

/* Add some spacing between meta items for better readability */
.pandat69-container .pandat69-task-item-meta span {
    display: inline-flex;
    align-items: center;
    margin-right: 15px;
}

/* Tab Navigation */
.pandat69-tabs {
    margin-bottom: 20px;
}

.pandat69-tab-navigation {
    display: flex;
    list-style: none;
    padding: 0;
    margin: 0 0 20px 0;
    border-bottom: 2px solid #e0e5eb;
}

.pandat69-tab-item {
    padding: 10px 20px;
    cursor: pointer;
    margin-right: 5px;
    border: 1px solid transparent;
    border-bottom: none;
    border-radius: 4px 4px 0 0;
    transition: all 0.2s ease;
    font-weight: 500;
    color: #5d6b7b;
}

.pandat69-tab-item:hover {
    background-color: #f5f7fa;
    border-color: #e0e5eb;
    color: #384D68;
}

.pandat69-tab-item.active {
    background-color: #fff;
    border-color: #e0e5eb;
    border-bottom: 2px solid #fff;
    margin-bottom: -2px;
    color: #384D68;
    font-weight: 600;
}

/* Tab Content */
.pandat69-tab-content {
    display: none;
    padding: 0;
}

.pandat69-tab-content.active {
    display: block;
}

/* Date Selector */
.pandat69-date-selector {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 20px;
    padding: 10px;
    background-color: #f5f7fa;
    border-radius: 4px;
}

.pandat69-current-week-display,
.pandat69-current-month-display {
    font-weight: 600;
    font-size: 1.1em;
    color: #384D68;
}

/* Week View */
.pandat69-week-table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 20px;
}

.pandat69-week-table th {
    background-color: #f5f7fa;
    padding: 10px;
    text-align: left;
    font-weight: 600;
    color: #384D68;
    border-bottom: 2px solid #e0e5eb;
}

.pandat69-week-table td {
    padding: 10px;
    border-bottom: 1px solid #e0e5eb;
    vertical-align: middle;
}

.pandat69-week-task-name {
    font-weight: 500;
    color: #384D68;
}

.pandat69-week-task-row:hover {
    background-color: #f9f9f9;
}

.pandat69-week-task-actions {
    display: flex;
    gap: 5px;
}

/* Month View */
.pandat69-month-date-group {
    margin-bottom: 25px;
}

.pandat69-month-date-header {
    padding: 10px;
    background-color: #f5f7fa;
    color: #384D68;
    font-size: 1.1em;
    font-weight: 600;
    border-radius: 4px;
    margin-bottom: 10px;
}

/* Status colors matching existing ones */
.pandat69-container .pandat69-status-option.pandat69-status-pending { background-color: #e9b44c; }
.pandat69-container .pandat69-status-option.pandat69-status-in-progress { background-color: #384D68; }
.pandat69-container .pandat69-status-option.pandat69-status-done { background-color: #3e8d63; }

/* Ensure consistent task styling across all views */
.pandat69-month-date-group .pandat69-task-list,
.pandat69-week-task-container .pandat69-task-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.pandat69-month-date-group .pandat69-task-item,
.pandat69-week-task-container .pandat69-task-item {
    background-color: #fff;
    border: 1px solid #e0e5eb;
    margin-bottom: 10px;
    padding: 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    transition: box-shadow 0.2s ease;
    flex-wrap: wrap;
}

.pandat69-month-date-group .pandat69-task-item:hover,
.pandat69-week-task-container .pandat69-task-item:hover {
    box-shadow: 0 2px 5px rgba(56, 77, 104, 0.1);
}

.pandat69-month-date-group .pandat69-task-item-details,
.pandat69-week-task-container .pandat69-task-item-details {
    flex-grow: 1;
    margin-right: 15px;
}

.pandat69-month-date-group .pandat69-task-item-name,
.pandat69-week-task-container .pandat69-task-item-name {
    font-weight: bold;
    color: #384D68;
    font-size: 1.1em;
    margin-bottom: 5px;
}

.pandat69-month-date-group .pandat69-task-item-meta,
.pandat69-week-task-container .pandat69-task-item-meta {
    font-size: 0.9em;
    color: #5d6b7b;
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
}

.pandat69-month-date-group .pandat69-task-item-actions,
.pandat69-week-task-container .pandat69-task-item-actions {
    display: flex;
    gap: 5px;
    flex-shrink: 0;
}

.pandat69-empty-day {
    padding: 10px;
    color: #5d6b7b;
    font-style: italic;
    background-color: #f9f9f9;
    border: 1px dashed #e0e5eb;
}

/* Responsive adjustments for week and month views */
@media (max-width: 768px) {
    .pandat69-month-date-group .pandat69-task-item,
    .pandat69-week-task-container .pandat69-task-item {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .pandat69-month-date-group .pandat69-task-item-actions,
    .pandat69-week-task-container .pandat69-task-item-actions {
        margin-top: 10px;
        align-self: flex-end;
    }
    
    .pandat69-month-date-group .pandat69-task-item-details,
    .pandat69-week-task-container .pandat69-task-item-details {
        margin-right: 0;
        margin-bottom: 10px;
        width: 100%;
    }
    
    .pandat69-month-date-group .pandat69-task-item-meta,
    .pandat69-week-task-container .pandat69-task-item-meta {
        flex-direction: column;
        gap: 5px;
    }
}

---assets\js/---


---includes/---


--class-pandat69-ajax.php--

<?php
if ( ! defined( 'ABSPATH' ) ) {
    exit;
}

class Pandat69_Ajax {

    public function register() {
        $ajax_actions = array(
            'fetch_tasks',
            'get_task_details',
            'add_task',
            'update_task',
            'delete_task',
            'fetch_categories',
            'add_category',
            'delete_category',
            'add_comment',
            'fetch_users',
            'quick_update_status',
        );

        foreach ($ajax_actions as $action) {
            add_action('wp_ajax_pandat69_' . $action, array($this, $action));
            // Add wp_ajax_nopriv_ if needed for public actions (not typical for task management)
        }
    }

    private function verify_nonce($action = 'pandat69_ajax_nonce') {
         if (!isset($_POST['nonce']) || !wp_verify_nonce(sanitize_text_field($_POST['nonce']), $action)) {
            wp_send_json_error(array('message' => 'Nonce verification failed.'), 403);
        }
    }

     private function check_permissions() {
         if (!is_user_logged_in()) {
             wp_send_json_error(array('message' => 'You must be logged in.'), 401);
         }
         // Add more capability checks if needed, e.g., based on board or task ownership
         // if (!current_user_can('edit_posts')) { // Example capability
         //    wp_send_json_error(array('message' => 'Insufficient permissions.'), 403);
         //}
     }

    // --- AJAX Handlers ---

    public function fetch_tasks() {
        $this->verify_nonce();
        $this->check_permissions();
    
        $board_name = isset($_POST['board_name']) ? sanitize_key($_POST['board_name']) : '';
        $search = isset($_POST['search']) ? sanitize_text_field($_POST['search']) : '';
        $sort = isset($_POST['sort']) ? sanitize_text_field($_POST['sort']) : 'name_asc';
        $status_filter = isset($_POST['status_filter']) ? sanitize_text_field($_POST['status_filter']) : '';
        
        // Add date filtering parameters
        $date_filter = isset($_POST['date_filter']) ? sanitize_text_field($_POST['date_filter']) : '';
        $start_date = isset($_POST['start_date']) ? sanitize_text_field($_POST['start_date']) : '';
        $end_date = isset($_POST['end_date']) ? sanitize_text_field($_POST['end_date']) : '';
        
        // Validate date format if provided (YYYY-MM-DD)
        if (!empty($start_date) && !preg_match('/^\d{4}-\d{2}-\d{2}$/', $start_date)) {
            $start_date = ''; // Invalid format
        }
        
        if (!empty($end_date) && !preg_match('/^\d{4}-\d{2}-\d{2}$/', $end_date)) {
            $end_date = ''; // Invalid format
        }
    
        list($sort_by, $sort_order) = explode('_', $sort . '_'); // Add '_' to handle cases without order
        $sort_order = strtoupper($sort_order) === 'DESC' ? 'DESC' : 'ASC';
    
        if (empty($board_name)) {
            wp_send_json_error(array('message' => 'Board name is required.'));
        }
    
        $tasks = Pandat69_DB::get_tasks($board_name, $search, $sort_by, $sort_order, $status_filter, $date_filter, $start_date, $end_date);
    
        if (is_array($tasks)) {
            wp_send_json_success(array('tasks' => $tasks));
        } else {
            wp_send_json_error(array('message' => 'Failed to fetch tasks.'));
        }
    }

    public function get_task_details() {
        $this->verify_nonce();
        $this->check_permissions();

        $task_id = isset($_POST['task_id']) ? absint($_POST['task_id']) : 0;

        if (!$task_id) {
            wp_send_json_error(array('message' => 'Invalid Task ID.'));
        }

        $task = Pandat69_DB::get_task($task_id);

        if ($task) {
            // Ensure description is not overly escaped if wp_kses_post was used correctly
             //$task->description = wp_kses_post($task->description); // Re-apply kses? Or just trust DB? Trust DB for now.
            wp_send_json_success(array('task' => $task));
        } else {
            wp_send_json_error(array('message' => 'Task not found.'));
        }
    }

    public function add_task() {
        $this->verify_nonce();
        $this->check_permissions();

        // Basic validation
        $required_fields = ['board_name', 'name', 'status', 'priority'];
        foreach($required_fields as $field) {
            if (empty($_POST[$field])) {
                 wp_send_json_error(array('message' => 'Missing required field: ' . $field));
            }
        }

        // Process assigned users - handle both array and comma-separated string
        $assigned_persons = [];
        if (!empty($_POST['assigned_persons'])) {
            if (is_array($_POST['assigned_persons'])) {
                $assigned_persons = array_map('absint', $_POST['assigned_persons']);
            } elseif (is_string($_POST['assigned_persons'])) {
                // Handle comma-separated string format from our new autocomplete UI
                $assigned_persons = array_map('absint', explode(',', $_POST['assigned_persons']));
            }
        }

        $data = array(
             'board_name' => sanitize_key($_POST['board_name']),
             'name' => sanitize_text_field($_POST['name']),
             'description' => isset($_POST['description']) ? wp_kses_post($_POST['description']) : '',
             'status' => sanitize_text_field($_POST['status']),
             'category_id' => isset($_POST['category_id']) ? absint($_POST['category_id']) : null,
             'priority' => absint($_POST['priority']),
             'deadline' => isset($_POST['deadline']) && !empty($_POST['deadline']) ? sanitize_text_field($_POST['deadline']) : null,
             'assigned_persons' => $assigned_persons,
             'notify_deadline' => isset($_POST['notify_deadline']) ? 1 : 0,
             'notify_days_before' => isset($_POST['notify_days_before']) ? max(1, min(30, absint($_POST['notify_days_before']))) : 3,
        );

         // Validate deadline format if provided
         if ($data['deadline'] && !preg_match('/^\d{4}-\d{2}-\d{2}$/', $data['deadline'])) {
              wp_send_json_error(array('message' => 'Invalid deadline format. Use YYYY-MM-DD.'));
         }

        $task_id = Pandat69_DB::add_task($data);

        if ($task_id) {
            // Optionally fetch the newly added task to return full data
            $new_task = Pandat69_DB::get_task($task_id);
            wp_send_json_success(array('message' => 'Task added successfully.', 'task' => $new_task));
        } else {
            wp_send_json_error(array('message' => 'Failed to add task. Check data or logs.'));
        }
    }

     public function update_task() {
        $this->verify_nonce();
        $this->check_permissions();

        $task_id = isset($_POST['task_id']) ? absint($_POST['task_id']) : 0;

        if (!$task_id) {
             wp_send_json_error(array('message' => 'Invalid Task ID.'));
        }

         // Basic validation
        $required_fields = ['name', 'status', 'priority'];
        foreach($required_fields as $field) {
            if (empty($_POST[$field])) {
                 wp_send_json_error(array('message' => 'Missing required field: ' . $field));
            }
        }

        // Process assigned users - handle both array and comma-separated string
        $assigned_persons = [];
        if (!empty($_POST['assigned_persons'])) {
            if (is_array($_POST['assigned_persons'])) {
                $assigned_persons = array_map('absint', $_POST['assigned_persons']);
            } elseif (is_string($_POST['assigned_persons'])) {
                // Handle comma-separated string format from our new autocomplete UI
                $assigned_persons = array_map('absint', explode(',', $_POST['assigned_persons']));
            }
        }

        $data = array(
             'name' => sanitize_text_field($_POST['name']),
             'description' => isset($_POST['description']) ? wp_kses_post($_POST['description']) : '',
             'status' => sanitize_text_field($_POST['status']),
             'category_id' => isset($_POST['category_id']) ? absint($_POST['category_id']) : null,
             'priority' => absint($_POST['priority']),
             'deadline' => isset($_POST['deadline']) && !empty($_POST['deadline']) ? sanitize_text_field($_POST['deadline']) : null,
             'assigned_persons' => $assigned_persons,
             'notify_deadline' => isset($_POST['notify_deadline']) ? 1 : 0,
             'notify_days_before' => isset($_POST['notify_days_before']) ? max(1, min(30, absint($_POST['notify_days_before']))) : 3,
        );

         // Validate deadline format if provided
         if ($data['deadline'] && !preg_match('/^\d{4}-\d{2}-\d{2}$/', $data['deadline'])) {
              wp_send_json_error(array('message' => 'Invalid deadline format. Use YYYY-MM-DD.'));
         }

        $result = Pandat69_DB::update_task($task_id, $data);

        if ($result) {
             // Optionally fetch the updated task to return full data
            $updated_task = Pandat69_DB::get_task($task_id);
            wp_send_json_success(array('message' => 'Task updated successfully.', 'task' => $updated_task));
        } else {
            wp_send_json_error(array('message' => 'Failed to update task.'));
        }
    }

    public function delete_task() {
        $this->verify_nonce();
        $this->check_permissions();

        $task_id = isset($_POST['task_id']) ? absint($_POST['task_id']) : 0;

        if (!$task_id) {
            wp_send_json_error(array('message' => 'Invalid Task ID.'));
        }

         // Add capability check: Can the current user delete this specific task?
         // e.g., check if user is admin or assigned to the task, or task creator etc.

        $result = Pandat69_DB::delete_task($task_id);

        if ($result) {
            wp_send_json_success(array('message' => 'Task deleted successfully.'));
        } else {
            wp_send_json_error(array('message' => 'Failed to delete task.'));
        }
    }

     public function fetch_categories() {
        $this->verify_nonce();
        $this->check_permissions();

        $board_name = isset($_POST['board_name']) ? sanitize_key($_POST['board_name']) : '';
        if (empty($board_name)) {
            wp_send_json_error(array('message' => 'Board name is required.'));
        }

        $categories = Pandat69_DB::get_categories($board_name);
         if (is_array($categories)) {
            wp_send_json_success(array('categories' => $categories));
        } else {
            wp_send_json_error(array('message' => 'Failed to fetch categories.'));
        }
    }

    public function add_category() {
         $this->verify_nonce();
         $this->check_permissions();

        $board_name = isset($_POST['board_name']) ? sanitize_key($_POST['board_name']) : '';
        $category_name = isset($_POST['name']) ? sanitize_text_field(trim($_POST['name'])) : '';

         if (empty($board_name) || empty($category_name)) {
            wp_send_json_error(array('message' => 'Board name and category name are required.'));
        }

        $category_id = Pandat69_DB::add_category($board_name, $category_name);

        if ($category_id) {
             wp_send_json_success(array('message' => 'Category added successfully.', 'category' => array('id' => $category_id, 'name' => $category_name)));
        } else {
            wp_send_json_error(array('message' => 'Failed to add category. It might already exist or the name is invalid.'));
        }
    }

    public function delete_category() {
        $this->verify_nonce();
        $this->check_permissions();

        $category_id = isset($_POST['category_id']) ? absint($_POST['category_id']) : 0;
        $board_name = isset($_POST['board_name']) ? sanitize_key($_POST['board_name']) : '';

        if (!$category_id || empty($board_name)) {
            wp_send_json_error(array('message' => 'Invalid Category ID or Board Name.'));
        }

         // Add capability check if needed

        $result = Pandat69_DB::delete_category($category_id, $board_name);

        if ($result) {
            wp_send_json_success(array('message' => 'Category deleted successfully.'));
        } else {
            wp_send_json_error(array('message' => 'Failed to delete category.'));
        }
    }

    public function add_comment() {
        $this->verify_nonce();
        $this->check_permissions();
    
        $task_id = isset($_POST['task_id']) ? absint($_POST['task_id']) : 0;
        $comment_text = isset($_POST['comment_text']) ? wp_kses_post(trim($_POST['comment_text'])) : '';
        $user_id = get_current_user_id();
    
        if (!$task_id || empty($comment_text) || !$user_id) {
             wp_send_json_error(array('message' => 'Missing required comment data.'));
        }
    
        // Process @mentions in format @[Username](123)
        $mentioned_users = array(); // Track mentioned users for notifications
        $comment_text = preg_replace_callback('/@\[(.*?)\]\((\d+)\)/', function($matches) use (&$mentioned_users) {
            $mentioned_user_name = $matches[1];
            $mentioned_user_id = intval($matches[2]);
            
            // Add to our tracking array for notifications
            if (!in_array($mentioned_user_id, $mentioned_users)) {
                $mentioned_users[] = $mentioned_user_id;
            }
            
            // Verify user exists
            $user = get_userdata($mentioned_user_id);
            if ($user) {
                // Create link based on user ID
                if (function_exists('bp_core_get_user_domain')) {
                    // BuddyPress profile link
                    return '<a href="' . bp_core_get_user_domain($mentioned_user_id) . '" class="pandat69-mention">@' . $mentioned_user_name . '</a>';
                } else {
                    // WordPress author page link
                    return '<a href="' . get_author_posts_url($mentioned_user_id) . '" class="pandat69-mention">@' . $mentioned_user_name . '</a>';
                }
            }
            return $matches[0]; // Return original if user not found
        }, $comment_text);
    
        $comment = Pandat69_DB::add_comment($task_id, $user_id, $comment_text);
    
        if ($comment) {
            // Get task to find assigned users for notifications
            $task = Pandat69_DB::get_task($task_id);
            
            // Send email notifications to assigned users
            if (class_exists('Pandat69_Email')) {
                Pandat69_Email::send_comment_notification($task_id, $user_id, $comment_text);
            }
            
            // Add BuddyPress notifications
            if (class_exists('Pandat69_Notifications') && $task) {
                // 1. Send comment notifications to assigned users
                if (!empty($task->assigned_user_ids)) {
                    foreach ($task->assigned_user_ids as $assigned_id) {
                        // Skip sending to the commenter themselves
                        if ($assigned_id != $user_id) {
                            Pandat69_Notifications::add_comment_notification($task_id, $assigned_id, $user_id);
                        }
                    }
                }
                
                // 2. Send mention notifications
                foreach ($mentioned_users as $mentioned_id) {
                    // Skip if mentioning yourself
                    if ($mentioned_id != $user_id) {
                        Pandat69_Notifications::add_mention_notification($task_id, $mentioned_id, $user_id);
                    }
                }
            }
            
            wp_send_json_success(array('message' => 'Comment added successfully.', 'comment' => $comment));
        } else {
            wp_send_json_error(array('message' => 'Failed to add comment.'));
        }
    }

     public function fetch_users() {
        // No nonce check here usually, as it might be called via GET for typeaheads,
        // but ensure it only returns public data (ID, name).
         $this->verify_nonce(); // Add if needed for security context
         $this->check_permissions(); // Still check login status

        $search = isset($_REQUEST['search']) ? sanitize_text_field($_REQUEST['search']) : ''; // Use REQUEST for flexibility

        if (pandat69_is_buddypress_active()) {
            $users = Pandat69_DB::get_buddypress_users($search);
        } else {
             $users = Pandat69_DB::get_wp_users($search);
        }

        wp_send_json_success(array('users' => $users));
    }

    public function quick_update_status() {
        $this->verify_nonce();
        $this->check_permissions();
    
        $task_id = isset($_POST['task_id']) ? absint($_POST['task_id']) : 0;
        $status = isset($_POST['status']) ? sanitize_text_field($_POST['status']) : '';
    
        if (!$task_id || empty($status)) {
            wp_send_json_error(array('message' => 'Task ID and status are required.'));
        }
    
        // Only update the status field
        $data = array(
            'status' => $status
        );
    
        $result = Pandat69_DB::update_task($task_id, $data);
    
        if ($result) {
            wp_send_json_success(array(
                'message' => 'Status updated successfully.',
                'status_text' => ucfirst(str_replace('-', ' ', $status))
            ));
        } else {
            wp_send_json_error(array('message' => 'Failed to update status.'));
        }
    }

} // End class

--class-pandat69-buddypress.php--

<?php
/**
 * Task Board BuddyPress Integration
 */
if ( ! defined( 'ABSPATH' ) ) {
    exit;
}

class Pandat69_BuddyPress {
    
    private static $instance;
    
    /**
     * Get the singleton instance
     */
    public static function get_instance() {
        if ( null === self::$instance ) {
            self::$instance = new self();
        }
        return self::$instance;
    }
    
    /**
     * Constructor
     */
    private function __construct() {
        // Only load if BuddyPress is active
        if ( function_exists( 'buddypress' ) ) {
            $this->setup_hooks();
        }
    }
    
    /**
     * Setup hooks
     */
    private function setup_hooks() {
        // Hook into BuddyPress init
        add_action( 'bp_init', array( $this, 'register_group_extension' ) );
    }
    
    /**
     * Register the group extension
     */
    public function register_group_extension() {
        // Only register if Groups component is active
        if ( bp_is_active( 'groups' ) ) {
            require_once PANDAT69_PLUGIN_DIR . 'includes/class-pandat69-group-extension.php';
            bp_register_group_extension( 'Pandat69_Group_Extension' );
        }
    }
}

--class-pandat69-db.php--

<?php
if ( ! defined( 'ABSPATH' ) ) {
    exit;
}

class Pandat69_DB {

    public static function activate() {
        self::create_tables();
    }

    public static function get_db_prefix() {
        global $wpdb;
        return $wpdb->prefix . 'pandat69_'; // Task Board Plugin prefix
    }

    public static function create_tables() {
        global $wpdb;
        $charset_collate = $wpdb->get_charset_collate();
        $prefix = self::get_db_prefix();

        $table_tasks = $prefix . 'tasks';
        $table_categories = $prefix . 'categories';
        $table_assignments = $prefix . 'assignments';
        $table_comments = $prefix . 'comments';

        require_once( ABSPATH . 'wp-admin/includes/upgrade.php' );

// In class-pandat69-db.php, modify the create_tables() method:

    $sql_tasks = "CREATE TABLE $table_tasks (
        id BIGINT(20) UNSIGNED NOT NULL AUTO_INCREMENT,
        board_name VARCHAR(100) NOT NULL,
        name VARCHAR(255) NOT NULL,
        description LONGTEXT NULL,
        status VARCHAR(20) NOT NULL DEFAULT 'pending',
        category_id BIGINT(20) UNSIGNED NULL,
        priority TINYINT UNSIGNED NOT NULL DEFAULT 5,
        deadline DATE NULL,
        notify_deadline TINYINT(1) NOT NULL DEFAULT 0,
        notify_days_before INT UNSIGNED NOT NULL DEFAULT 3,
        created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
        updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
        PRIMARY KEY  (id),
        KEY board_name (board_name),
        KEY status (status),
        KEY priority (priority),
        KEY deadline (deadline),
        KEY category_id (category_id)
    ) $charset_collate;";
        dbDelta( $sql_tasks );

        $sql_categories = "CREATE TABLE $table_categories (
            id BIGINT(20) UNSIGNED NOT NULL AUTO_INCREMENT,
            board_name VARCHAR(100) NOT NULL,
            name VARCHAR(100) NOT NULL,
            PRIMARY KEY  (id),
            UNIQUE KEY board_name_name (board_name, name),
            KEY board_name (board_name)
        ) $charset_collate;";
        dbDelta( $sql_categories );

        $sql_assignments = "CREATE TABLE $table_assignments (
            id BIGINT(20) UNSIGNED NOT NULL AUTO_INCREMENT,
            task_id BIGINT(20) UNSIGNED NOT NULL,
            user_id BIGINT(20) UNSIGNED NOT NULL,
            PRIMARY KEY  (id),
            UNIQUE KEY task_user (task_id, user_id),
            KEY task_id (task_id),
            KEY user_id (user_id)
        ) $charset_collate;";
        dbDelta( $sql_assignments );

        $sql_comments = "CREATE TABLE $table_comments (
            id BIGINT(20) UNSIGNED NOT NULL AUTO_INCREMENT,
            task_id BIGINT(20) UNSIGNED NOT NULL,
            user_id BIGINT(20) UNSIGNED NOT NULL,
            comment_text TEXT NOT NULL,
            created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
            PRIMARY KEY  (id),
            KEY task_id (task_id),
            KEY user_id (user_id)
        ) $charset_collate;";
        dbDelta( $sql_comments );
    }

    // --- Task CRUD ---

    public static function get_tasks($board_name, $search = '', $sort_by = 'name', $sort_order = 'ASC', $status_filter = '', $date_filter = '', $start_date = '', $end_date = '') {
        global $wpdb;
        $prefix = self::get_db_prefix();
        $tasks_table = $prefix . 'tasks';
        $assignments_table = $prefix . 'assignments';
        $users_table = $wpdb->users;
        $categories_table = $prefix . 'categories';

        $sql = $wpdb->prepare(
            "SELECT t.*, c.name as category_name, GROUP_CONCAT(DISTINCT u.ID SEPARATOR ',') as assigned_user_ids, GROUP_CONCAT(DISTINCT u.display_name SEPARATOR ', ') as assigned_user_names
             FROM {$tasks_table} t
             LEFT JOIN {$categories_table} c ON t.category_id = c.id AND c.board_name = t.board_name
             LEFT JOIN {$assignments_table} a ON t.id = a.task_id
             LEFT JOIN {$users_table} u ON a.user_id = u.ID
             WHERE t.board_name = %s",
            $board_name
        );

        if (!empty($search)) {
            $search_term = '%' . $wpdb->esc_like($search) . '%';
            $sql .= $wpdb->prepare(
                " AND (t.name LIKE %s OR t.description LIKE %s OR u.display_name LIKE %s)",
                $search_term, $search_term, $search_term
            );
        }

        if (!empty($status_filter)) {
             $sql .= $wpdb->prepare(" AND t.status = %s", $status_filter);
        }
        
        // Add date range filtering
        if ($date_filter === 'range' && !empty($start_date) && !empty($end_date)) {
            $sql .= $wpdb->prepare(
                " AND (t.deadline BETWEEN %s AND %s OR t.deadline IS NULL)",
                $start_date, $end_date
            );
        }

        $sql .= " GROUP BY t.id";

        // Sorting logic
        $allowed_sort_columns = ['name', 'priority', 'deadline', 'status', 'assigned_user_names', 'category_name'];
        if (in_array($sort_by, $allowed_sort_columns)) {
            $order = (strtoupper($sort_order) === 'DESC') ? 'DESC' : 'ASC';
             // Special case for assigned users as it's a concatenated string
             if ($sort_by === 'assigned_user_names') {
                 $sql .= " ORDER BY assigned_user_names {$order}"; // Simple string sort
             } elseif ($sort_by === 'category_name') {
                 $sql .= " ORDER BY c.name {$order}";
             } else {
                $sql .= " ORDER BY t.{$sort_by} {$order}";
            }
        } else {
            $sql .= " ORDER BY t.name ASC"; // Default sort
        }

        $results = $wpdb->get_results($sql);

        // Normalize data (e.g., split user ids)
        foreach ($results as $task) {
            $task->assigned_user_ids = !empty($task->assigned_user_ids) ? explode(',', $task->assigned_user_ids) : [];
            $task->assigned_user_names = !empty($task->assigned_user_names) ? $task->assigned_user_names : 'Unassigned';
            $task->category_name = $task->category_name ?? 'Uncategorized';
        }

        return $results;
    }

    public static function update_db_check() {
        $current_version = get_option('pandat69_db_version', '1.0.0');
        
        if (version_compare($current_version, '1.0.8', '<')) {
            global $wpdb;
            $prefix = self::get_db_prefix();
            $table_tasks = $prefix . 'tasks';
            
            // Check if columns exist before adding
            $columns = $wpdb->get_results("SHOW COLUMNS FROM $table_tasks");
            $column_names = wp_list_pluck($columns, 'Field');
            
            if (!in_array('notify_deadline', $column_names)) {
                $wpdb->query("ALTER TABLE $table_tasks ADD COLUMN notify_deadline TINYINT(1) NOT NULL DEFAULT 0");
            }
            
            if (!in_array('notify_days_before', $column_names)) {
                $wpdb->query("ALTER TABLE $table_tasks ADD COLUMN notify_days_before INT UNSIGNED NOT NULL DEFAULT 3");
            }
            
            update_option('pandat69_db_version', '1.0.8');
        }
    }

    public static function get_task($task_id) {
        global $wpdb;
        $prefix = self::get_db_prefix();
        $tasks_table = $prefix . 'tasks';
        $assignments_table = $prefix . 'assignments';
        $users_table = $wpdb->users;
        $categories_table = $prefix . 'categories';

        $sql = $wpdb->prepare(
            "SELECT t.*, c.name as category_name, GROUP_CONCAT(DISTINCT u.ID) as assigned_user_ids, GROUP_CONCAT(DISTINCT u.display_name SEPARATOR ', ') as assigned_user_names
             FROM {$tasks_table} t
             LEFT JOIN {$categories_table} c ON t.category_id = c.id AND c.board_name = t.board_name
             LEFT JOIN {$assignments_table} a ON t.id = a.task_id
             LEFT JOIN {$users_table} u ON a.user_id = u.ID
             WHERE t.id = %d
             GROUP BY t.id",
            $task_id
        );
        $task = $wpdb->get_row($sql);

        if ($task) {
            $task->assigned_user_ids = !empty($task->assigned_user_ids) ? explode(',', $task->assigned_user_ids) : [];
            $task->assigned_user_names = !empty($task->assigned_user_names) ? $task->assigned_user_names : 'Unassigned';
             $task->category_name = $task->category_name ?? 'Uncategorized';
             $task->comments = self::get_comments($task_id);
             // Ensure description is properly handled (might need stripslashes if addslashes was used incorrectly elsewhere)
             $task->description = stripslashes($task->description ?? '');
        }

        return $task;
    }

     public static function add_task($data) {
        global $wpdb;
        $prefix = self::get_db_prefix();
        $tasks_table = $prefix . 'tasks';
        $assignments_table = $prefix . 'assignments';

        $task_data = array(
            'board_name'    => sanitize_text_field($data['board_name']),
            'name'          => sanitize_text_field($data['name']),
            'description'   => wp_kses_post($data['description']), // Allow TinyMCE content
            'status'        => sanitize_text_field($data['status']),
            'category_id'   => !empty($data['category_id']) ? absint($data['category_id']) : null,
            'priority'      => max(1, min(10, absint($data['priority']))),
            'deadline'      => !empty($data['deadline']) ? sanitize_text_field($data['deadline']) : null,
            'created_at'    => current_time('mysql', 1),
            'updated_at'    => current_time('mysql', 1),
        );

        $format = array('%s', '%s', '%s', '%s', '%d', '%d', '%s', '%s', '%s');
        if ($task_data['category_id'] === null) {
            $format[4] = '%s'; // Pass null correctly
        }
        if ($task_data['deadline'] === null) {
            $format[6] = '%s';
        }


        $result = $wpdb->insert($tasks_table, $task_data, $format);

        if ($result === false) {
            error_log("PANDAT69 DB Error adding task: " . $wpdb->last_error);
            return false;
        }
        $task_id = $wpdb->insert_id;

        // Handle assignments
        self::update_task_assignments($task_id, $data['assigned_persons'] ?? []);

        return $task_id;
    }

    /**
     * Updates a task in the database.
     * Only updates fields that are present in the $data array.
     *
     * @param int   $task_id The ID of the task to update.
     * @param array $data    Associative array of data to update (e.g., ['status' => 'done', 'priority' => 7]).
     *                       Can also include 'assigned_persons' => [1, 2, 3] for assignment updates.
     * @return bool True on success, false on failure.
     */
    public static function update_task($task_id, $data) {
        global $wpdb;
        $prefix = self::get_db_prefix();
        $tasks_table = $prefix . 'tasks';

        // Whitelist of allowed fields in the 'tasks' table that can be updated this way
        $allowed_task_fields = [
            'name', 'description', 'status', 'category_id', 'priority', 'deadline'
        ];

        $update_data = []; // Array to hold columns to be updated in the DB
        $format = [];      // Corresponding formats for $wpdb->update

        // Build the update array and format array based ONLY on what's in $data
        foreach ($data as $key => $value) {
            // Only process fields that are allowed for the tasks table
            if (!in_array($key, $allowed_task_fields)) {
                continue;
            }

            // Sanitize and format based on the field key
            if ($key === 'name') {
                $update_data['name'] = sanitize_text_field($value);
                $format[] = '%s';
            } elseif ($key === 'description') {
                $update_data['description'] = wp_kses_post($value);
                $format[] = '%s';
            } elseif ($key === 'status') {
                $update_data['status'] = sanitize_text_field($value);
                $format[] = '%s';
            } elseif ($key === 'category_id') {
                // Handle empty/null category selection
                $update_data['category_id'] = !empty($value) ? absint($value) : null;
                // Use %s format for NULL, %d otherwise
                $format[] = ($update_data['category_id'] === null) ? '%s' : '%d';
            } elseif ($key === 'priority') {
                $update_data['priority'] = max(1, min(10, absint($value)));
                $format[] = '%d';
            } elseif ($key === 'deadline') {
                 // Handle empty/null deadline and validate format
                 if (empty($value)) {
                     $update_data['deadline'] = null;
                     $format[] = '%s';
                 } elseif (preg_match('/^\d{4}-\d{2}-\d{2}$/', $value)) { // Basic YYYY-MM-DD check
                     $update_data['deadline'] = sanitize_text_field($value);
                     $format[] = '%s';
                 } else {
                     // Invalid date format passed - skip updating this field to prevent errors
                     // Optionally log this: error_log("PANDAT69 Invalid deadline format received for task $task_id: $value");
                     continue;
                 }
            }
        }

        // If no valid task fields were provided to update, only handle assignments if present
        if (empty($update_data)) {
            if (isset($data['assigned_persons'])) {
                self::update_task_assignments($task_id, $data['assigned_persons']);
            }
            // Decide if returning true/false makes sense. Let's return true as no DB error occurred.
            return true;
        }

        // Always add/update the 'updated_at' timestamp
        $update_data['updated_at'] = current_time('mysql', 1);
        $format[] = '%s';

        // Prepare the WHERE clause
        $where = array('id' => $task_id);
        $where_format = array('%d');

        // Perform the database update
        $result = $wpdb->update($tasks_table, $update_data, $where, $format, $where_format);

        // Check for DB errors
        if ($result === false) {
            error_log("PANDAT69 DB Error updating task $task_id: " . $wpdb->last_error);
            return false;
        }

        // Handle assignments (if 'assigned_persons' was passed in the original $data)
        // This is kept separate because assignments are in a different table
        if (isset($data['assigned_persons'])) {
            self::update_task_assignments($task_id, $data['assigned_persons']);
        }

        // Return true if the update query executed without error
        // Note: $result might be 0 if the data didn't actually change, but that's not an error.
        return true;
    }

    public static function delete_task($task_id) {
        global $wpdb;
        $prefix = self::get_db_prefix();
        $tasks_table = $prefix . 'tasks';
        $assignments_table = $prefix . 'assignments';
        $comments_table = $prefix . 'comments';

        // Delete assignments first
        $wpdb->delete($assignments_table, array('task_id' => $task_id), array('%d'));

        // Delete comments
         $wpdb->delete($comments_table, array('task_id' => $task_id), array('%d'));

        // Delete task
        $result = $wpdb->delete($tasks_table, array('id' => $task_id), array('%d'));

        return $result !== false;
    }

    private static function update_task_assignments($task_id, $assigned_user_ids) {
        global $wpdb;
        $prefix = self::get_db_prefix();
        $assignments_table = $prefix . 'assignments';

        // Ensure input is an array of integers
        $new_assigned_ids = array_map('absint', (array) $assigned_user_ids);
        $new_assigned_ids = array_filter($new_assigned_ids); // Remove zeros/invalid

        // Get current assignments
        $current_assignments = $wpdb->get_results( $wpdb->prepare( "SELECT user_id FROM {$assignments_table} WHERE task_id = %d", $task_id ) );
        $current_assigned_ids = wp_list_pluck( $current_assignments, 'user_id' );

        // Find users to remove
        $users_to_remove = array_diff($current_assigned_ids, $new_assigned_ids);
        if (!empty($users_to_remove)) {
            $placeholders = implode(',', array_fill(0, count($users_to_remove), '%d'));
            $sql = $wpdb->prepare(
                "DELETE FROM {$assignments_table} WHERE task_id = %d AND user_id IN ($placeholders)",
                 array_merge( [$task_id], $users_to_remove )
            );
             $wpdb->query($sql);
        }

        // Find users to add
        // Find users to add
        $users_to_add = array_diff($new_assigned_ids, $current_assigned_ids);
        if (!empty($users_to_add)) {
            foreach ($users_to_add as $user_id) {
                $wpdb->insert(
                    $assignments_table,
                    array('task_id' => $task_id, 'user_id' => $user_id),
                    array('%d', '%d')
                );
            }

            // Send email notifications to newly assigned users
            if (class_exists('Pandat69_Email')) {
                Pandat69_Email::send_assignment_notification($task_id, $users_to_add);
            }
            
            // Add BP notifications for assignment
            if (class_exists('Pandat69_Notifications')) {
                $current_user_id = get_current_user_id();
                foreach ($users_to_add as $user_id) {
                    // Skip if assigning to yourself
                    if ($user_id != $current_user_id) {
                        Pandat69_Notifications::add_assignment_notification($task_id, $user_id, $current_user_id);
                    }
                }
            }
        }
    }

    // --- Category CRUD ---

     public static function get_categories($board_name) {
        global $wpdb;
        $prefix = self::get_db_prefix();
        $categories_table = $prefix . 'categories';
        return $wpdb->get_results($wpdb->prepare(
            "SELECT id, name FROM {$categories_table} WHERE board_name = %s ORDER BY name ASC",
            $board_name
        ));
    }

    public static function add_category($board_name, $category_name) {
        global $wpdb;
        $prefix = self::get_db_prefix();
        $categories_table = $prefix . 'categories';

        $name = sanitize_text_field($category_name);
        if (empty($name)) return false; // Name cannot be empty

        $data = array(
            'board_name' => sanitize_text_field($board_name),
            'name'       => $name,
        );
        $format = array('%s', '%s');

        // Check for duplicates for this board
        $exists = $wpdb->get_var($wpdb->prepare(
             "SELECT COUNT(*) FROM {$categories_table} WHERE board_name = %s AND name = %s",
             $data['board_name'], $data['name']
        ));
        if ($exists > 0) return false; // Already exists

        $result = $wpdb->insert($categories_table, $data, $format);
        return $result !== false ? $wpdb->insert_id : false;
    }

    public static function delete_category($category_id, $board_name) {
        global $wpdb;
        $prefix = self::get_db_prefix();
        $categories_table = $prefix . 'categories';
        $tasks_table = $prefix . 'tasks';

        // Optional: Update tasks using this category to null or a default category
        $wpdb->update(
            $tasks_table,
            array('category_id' => null),
            array('category_id' => $category_id, 'board_name' => $board_name),
            array('%s'), // Format for category_id (null)
            array('%d', '%s') // Where format
        );


        $result = $wpdb->delete(
            $categories_table,
             array('id' => $category_id, 'board_name' => $board_name),
             array('%d', '%s')
        );
        return $result !== false;
    }

    // --- Comment CRUD ---

     public static function get_comments($task_id) {
        global $wpdb;
        $prefix = self::get_db_prefix();
        $comments_table = $prefix . 'comments';
        $users_table = $wpdb->users;

        return $wpdb->get_results($wpdb->prepare(
            "SELECT c.*, u.display_name as user_name
             FROM {$comments_table} c
             JOIN {$users_table} u ON c.user_id = u.ID
             WHERE c.task_id = %d
             ORDER BY c.created_at ASC",
            $task_id
        ));
    }

    public static function add_comment($task_id, $user_id, $comment_text) {
        global $wpdb;
        $prefix = self::get_db_prefix();
        $comments_table = $prefix . 'comments';

        $data = array(
            'task_id'       => absint($task_id),
            'user_id'       => absint($user_id),
            'comment_text'  => wp_kses_post($comment_text), // Allow some HTML, adjust as needed
            'created_at'    => current_time('mysql', 1),
        );
        $format = array('%d', '%d', '%s', '%s');

        $result = $wpdb->insert($comments_table, $data, $format);
        if ($result) {
            // Return the newly added comment with user info
            $comment_id = $wpdb->insert_id;
            $users_table = $wpdb->users;
            $comment = $wpdb->get_row($wpdb->prepare(
                 "SELECT c.*, u.display_name as user_name
                  FROM {$comments_table} c
                  JOIN {$users_table} u ON c.user_id = u.ID
                  WHERE c.id = %d",
                  $comment_id
             ));

            // Send email notifications to assigned users
            if (class_exists('Pandat69_Email')) {
                Pandat69_Email::send_comment_notification($task_id, $user_id, $comment_text);
            }

            return $comment;
        }
        return false;
    }

    // --- User Fetching ---

    public static function get_buddypress_users($search = '') {
        if (!function_exists('pandat69_is_buddypress_active') || !pandat69_is_buddypress_active()) {
            // Fallback to standard WP users if BuddyPress is not active or helper function missing
            return self::get_wp_users($search);
        }

        $args = array(
            'type' => 'alphabetical', // Or 'active', 'newest', 'popular'
            'per_page' => 50, // Limit results for performance
            'search_terms' => $search ? sanitize_text_field($search) : false,
        );

        if ( bp_has_members( $args ) ) :
            $members = array();
            while ( bp_members() ) : bp_the_member();
                 global $members_template;
                 if(isset($members_template->member)) { // Add check for member object
                    $members[] = array(
                        'id' => $members_template->member->id,
                        'name' => $members_template->member->display_name,
                    );
                 }
            endwhile;
            return $members;
        else:
            return array();
        endif;

    }

     public static function get_wp_users($search = '') {
        $args = array(
            'orderby' => 'display_name',
            'order' => 'ASC',
            'number' => 50, // Limit results
            'fields' => array('ID', 'display_name'),
        );
        if (!empty($search)) {
            $args['search'] = '*' . esc_attr( $search ) . '*';
             $args['search_columns'] = array( 'user_login', 'user_nicename', 'user_email', 'display_name' );
        }

        $users = get_users($args);
        $formatted_users = [];
        foreach ($users as $user) {
            $formatted_users[] = ['id' => $user->ID, 'name' => $user->display_name];
        }
        return $formatted_users;
    }
}

--class-pandat69-deadline-notifications.php--

<?php
/**
 * Deadline notification handler for Task Board
 */
if (!defined('ABSPATH')) {
    exit;
}

class Pandat69_Deadline_Notifications {
    
    public static function init() {
        // Register the cron event if not already scheduled
        if (!wp_next_scheduled('pandat69_check_deadlines')) {
            wp_schedule_event(time(), 'daily', 'pandat69_check_deadlines');
        }
        
        // Hook the action
        add_action('pandat69_check_deadlines', array(__CLASS__, 'check_approaching_deadlines'));
    }
    
    /**
     * Check for tasks with approaching deadlines
     */
    public static function check_approaching_deadlines() {
        global $wpdb;
        $prefix = Pandat69_DB::get_db_prefix();
        $tasks_table = $prefix . 'tasks';
        $assignments_table = $prefix . 'assignments';
        
        // Get today's date
        $today = date('Y-m-d');
        
        // Find tasks with deadlines approaching according to their notify_days_before setting
        $query = "
            SELECT t.*, GROUP_CONCAT(a.user_id) as assigned_users
            FROM {$tasks_table} t
            LEFT JOIN {$assignments_table} a ON t.id = a.task_id
            WHERE 
                t.notify_deadline = 1 
                AND t.deadline IS NOT NULL 
                AND t.status != 'done' 
                AND DATE(t.deadline) > %s
                AND DATEDIFF(t.deadline, %s) = t.notify_days_before
            GROUP BY t.id
        ";
        
        $results = $wpdb->get_results($wpdb->prepare($query, $today, $today));
        
        if (empty($results)) {
            return;
        }
        
        // Process each task with approaching deadline
        foreach ($results as $task) {
            // Skip if no assigned users
            if (empty($task->assigned_users)) {
                continue;
            }
            
            $assigned_users = explode(',', $task->assigned_users);
            
            // Send notifications
            foreach ($assigned_users as $user_id) {
                // Send email notification
                if (class_exists('Pandat69_Email')) {
                    Pandat69_Email::send_deadline_notification($task->id, $user_id);
                }
                
                // Send BuddyPress notification
                if (class_exists('Pandat69_Notifications')) {
                    Pandat69_Notifications::add_deadline_notification($task->id, $user_id);
                }
            }
        }
    }
    
    /**
     * Deactivation cleanup
     */
    public static function deactivate() {
        // Clear the scheduled event
        $timestamp = wp_next_scheduled('pandat69_check_deadlines');
        if ($timestamp) {
            wp_unschedule_event($timestamp, 'pandat69_check_deadlines');
        }
    }
}

// Initialize
Pandat69_Deadline_Notifications::init();

--class-pandat69-email.php--

<?php
if ( ! defined( 'ABSPATH' ) ) {
    exit;
}

class Pandat69_Email {

    /**
     * Send notification to newly assigned users
     * 
     * @param int $task_id The task ID
     * @param array $new_user_ids Array of newly assigned user IDs
     * @return void
     */
    public static function send_assignment_notification($task_id, $new_user_ids) {
        // Removed log_message call
        
        if (empty($new_user_ids)) {
            // Removed log_message call
            return;
        }
        
        // Get task details
        $task = Pandat69_DB::get_task($task_id);
        if (!$task) {
            // Removed log_message call
            return;
        }
        
        // Removed log_message call
        
        $admin_email = get_option('admin_email'); // Used for 'From' address fallback
        $site_name = get_bloginfo('name');
        $site_url = home_url();
        
        // Try to determine task URL
        $task_url = self::get_task_board_url($task->board_name);
        // Removed log_message call
        
        foreach ($new_user_ids as $user_id) {
            $user = get_userdata($user_id);
            if (!$user || !is_a($user, 'WP_User') || !$user->user_email) {
                // Removed log_message call
                continue;
            }
            
            // Removed log_message call
            
            // translators: %s: Site name.
            $subject = sprintf(__('You have been assigned to a task on %s', 'pandatask'), $site_name);
            
            // --- Plain text email ---
            // translators: %s: User display name.
            $greeting = sprintf( __('Hello %s,', 'pandatask'), $user->display_name );
            $assignment_intro = __('You have been assigned to the following task:', 'pandatask');
            // translators: %s: Task name.
            $task_line = sprintf( __('Task: %s', 'pandatask'), $task->name );
             // translators: %s: Task status (e.g., "Pending", "In Progress").
            $status_line = sprintf( __('Status: %s', 'pandatask'), ucfirst(str_replace('-', ' ', $task->status)) );
             // translators: %s: Task priority number (1-10).
            $priority_line = sprintf( __('Priority: %s', 'pandatask'), $task->priority );
             // translators: %s: Task deadline string (e.g., "YYYY-MM-DD" or "No deadline").
            $deadline_line = sprintf( __('Deadline: %s', 'pandatask'), $task->deadline ?: __('No deadline', 'pandatask') );
            $instructions = __('Please login to view the task details and update its status as needed.', 'pandatask');
            $task_link_line = '';
            if ($task_url) {
                // translators: %s: URL to the task board.
                $task_link_line = sprintf( __('View Task Board: %s', 'pandatask'), $task_url ) . "\n\n";
            }
            $regards = __('Regards,', 'pandatask');
             // FIX: Directly use the site name variable, don't try to translate '%s'.
            $signature = $site_name; 

            $text_message = $greeting . "\n\n" .
                            $assignment_intro . "\n\n" .
                            $task_line . "\n" .
                            $status_line . "\n" .
                            $priority_line . "\n" .
                            $deadline_line . "\n\n" .
                            $instructions . "\n\n" .
                            $task_link_line . // Already includes \n\n if present
                            $regards . "\n" .
                            $signature; // Use the variable directly
            
            // --- HTML email ---
            // Note: The HTML version correctly uses esc_html($site_name) directly, no change needed here.
            $html_message = '<p>' . esc_html($greeting) . '</p>' .
                            '<p>' . esc_html($assignment_intro) . '</p>' .
                            '<table style="border-collapse: collapse; width: 100%%; margin-bottom: 20px; border: 1px solid #ddd;">' .
                                '<tr><td style="padding: 8px; border: 1px solid #ddd; width: 30%"><strong>' . esc_html(__('Task', 'pandatask')) . '</strong></td><td style="padding: 8px; border: 1px solid #ddd;">' . esc_html($task->name) . '</td></tr>' .
                                '<tr><td style="padding: 8px; border: 1px solid #ddd;"><strong>' . esc_html(__('Status', 'pandatask')) . '</strong></td><td style="padding: 8px; border: 1px solid #ddd;">' . esc_html(ucfirst(str_replace('-', ' ', $task->status))) . '</td></tr>' .
                                '<tr><td style="padding: 8px; border: 1px solid #ddd;"><strong>' . esc_html(__('Priority', 'pandatask')) . '</strong></td><td style="padding: 8px; border: 1px solid #ddd;">' . esc_html($task->priority) . '</td></tr>' .
                                '<tr><td style="padding: 8px; border: 1px solid #ddd;"><strong>' . esc_html(__('Deadline', 'pandatask')) . '</strong></td><td style="padding: 8px; border: 1px solid #ddd;">' . esc_html($task->deadline ?: __('No deadline', 'pandatask')) . '</td></tr>' .
                            '</table>' .
                            '<p>' . esc_html($instructions) . '</p>' .
                            ($task_url ? '<p><a href="' . esc_url($task_url) . '" style="background-color: #384D68; color: white; padding: 10px 15px; text-decoration: none; border-radius: 4px; display: inline-block;">' . esc_html(__('View Task Board', 'pandatask')) . '</a></p>' : '') .
                            '<p>' . esc_html($regards) . '<br>' . esc_html($site_name) . '</p>';
            
            self::send_email($user->user_email, $subject, $text_message, $html_message);
        }
    }
    
    /**
     * Send notification to assigned users when a comment is added
     * 
     * @param int $task_id The task ID
     * @param int $comment_user_id The user ID who added the comment
     * @param string $comment_text The comment text (HTML allowed from DB)
     * @return void
     */
    public static function send_comment_notification($task_id, $comment_user_id, $comment_text) {
        // Removed log_message call
        
        // Get task details
        $task = Pandat69_DB::get_task($task_id);
        if (!$task || empty($task->assigned_user_ids)) {
            // Removed log_message call
            return;
        }
        
        // Removed log_message call
        
        $admin_email = get_option('admin_email'); // Used for 'From' address fallback
        $site_name = get_bloginfo('name');
        $commenter = get_userdata($comment_user_id);
        
        if (!$commenter || !is_a($commenter, 'WP_User')) {
             // translators: Fallback name if the user who commented cannot be found.
            $commenter_name = __('A user', 'pandatask');
            // Removed log_message call
        } else {
            $commenter_name = $commenter->display_name;
            // Removed log_message call
        }
        
        // Clean up comment text for *plain text* email (keep HTML for HTML version)
        $plain_text_comment = wp_strip_all_tags(preg_replace('/<a\s+[^>]*class="pandat69-mention"[^>]*>@([^<]+)<\/a>/i', '@$1', $comment_text));
        // Removed log_message call
        
        // Try to determine task URL
        $task_url = self::get_task_board_url($task->board_name);
        // Removed log_message call
        
        foreach ($task->assigned_user_ids as $user_id) {
            // Skip sending notification to the commenter themselves
            if ($user_id == $comment_user_id) {
                // Removed log_message call
                continue;
            }
            
            $user = get_userdata($user_id);
            if (!$user || !is_a($user, 'WP_User') || !$user->user_email) {
                // Removed log_message call
                continue;
            }
            
            // Removed log_message call
            
             // translators: %s: Task name.
            $subject = sprintf(__('New comment on task: %s', 'pandatask'), $task->name);
            
            // --- Plain text email ---
            // translators: %s: User display name.
            $greeting = sprintf( __('Hello %s,', 'pandatask'), $user->display_name );
             // translators: %s: Name of the user who added the comment.
            $comment_intro = sprintf( __('%s has commented on a task you are assigned to:', 'pandatask'), $commenter_name );
            // translators: %s: Task name.
            $task_line = sprintf( __('Task: %s', 'pandatask'), $task->name );
            // translators: %s: The plain text content of the comment.
            $comment_line = sprintf( __('Comment: %s', 'pandatask'), $plain_text_comment );
            $instructions = __('Please login to view the task and respond if needed.', 'pandatask');
            $task_link_line = '';
            if ($task_url) {
                // translators: %s: URL to the task board.
                $task_link_line = sprintf( __('View Task Board: %s', 'pandatask'), $task_url ) . "\n\n";
            }
            $regards = __('Regards,', 'pandatask');
             // FIX: Directly use the site name variable, don't try to translate '%s'.
            $signature = $site_name;

            $text_message = $greeting . "\n\n" .
                            $comment_intro . "\n\n" .
                            $task_line . "\n" .
                            $comment_line . "\n\n" .
                            $instructions . "\n\n" .
                            $task_link_line .
                            $regards . "\n" .
                            $signature; // Use the variable directly
            
            // --- HTML email ---
            // Note: The HTML version correctly uses esc_html($site_name) directly, no change needed here.
            $html_message = '<p>' . esc_html($greeting) . '</p>' .
                            '<p>' . esc_html($comment_intro) . '</p>' .
                            '<table style="border-collapse: collapse; width: 100%%; margin-bottom: 20px; border: 1px solid #ddd;">' .
                                '<tr><td style="padding: 8px; border: 1px solid #ddd; width: 30%"><strong>' . esc_html(__('Task', 'pandatask')) . '</strong></td><td style="padding: 8px; border: 1px solid #ddd;">' . esc_html($task->name) . '</td></tr>' .
                                '<tr><td style="padding: 8px; border: 1px solid #ddd;"><strong>' . esc_html(__('Comment', 'pandatask')) . '</strong></td><td style="padding: 8px; border: 1px solid #ddd;">' . wp_kses_post($comment_text) . '</td></tr>' . // Use wp_kses_post again for safety
                            '</table>' .
                            '<p>' . esc_html($instructions) . '</p>' .
                            ($task_url ? '<p><a href="' . esc_url($task_url) . '" style="background-color: #384D68; color: white; padding: 10px 15px; text-decoration: none; border-radius: 4px; display: inline-block;">' . esc_html(__('View Task Board', 'pandatask')) . '</a></p>' : '') .
                            '<p>' . esc_html($regards) . '<br>' . esc_html($site_name) . '</p>';
            
            self::send_email($user->user_email, $subject, $text_message, $html_message);
        }
    }
    
    /**
     * Helper function to send email with both HTML and plain text versions
     */
    private static function send_email($to, $subject, $text_message, $html_message) {
        $admin_email = get_option('admin_email');
        $site_name = get_bloginfo('name');
        
        // Removed log_message call
        
        // Use WordPress default From Name/Email if available, otherwise construct one.
        $from_name = apply_filters('wp_mail_from_name', get_bloginfo('name'));
        $from_email = apply_filters('wp_mail_from', $admin_email);
        
        $headers = array(
            'From: ' . $from_name . ' <' . $from_email . '>',
            // Set multipart content type for HTML + Plain Text
            'Content-Type: multipart/alternative; boundary="boundary-pandat69-mail"', 
        );
        
        // Build the multipart message body
        // Start with plain text part
        $message = "--boundary-pandat69-mail\r\n";
        $message .= "Content-Type: text/plain; charset=UTF-8\r\n";
        $message .= "Content-Transfer-Encoding: 8bit\r\n\r\n";
        $message .= $text_message . "\r\n\r\n"; // Add plain text message

        // Add HTML part
        $message .= "--boundary-pandat69-mail\r\n";
        $message .= "Content-Type: text/html; charset=UTF-8\r\n";
        $message .= "Content-Transfer-Encoding: 8bit\r\n\r\n";
        $message .= "<html><body>" . $html_message . "</body></html>\r\n\r\n"; // Add HTML message

        // End the boundary
        $message .= "--boundary-pandat69-mail--\r\n";

        // Removed header logging loop
        
        if (!function_exists('wp_mail')) {
            // Removed log_message call
            // Maybe add a standard PHP error_log here if wp_mail is critical and missing
            error_log('Task Board Plugin Error: wp_mail function does not exist!');
            return false;
        }
        
        // Send the email
        $result = wp_mail($to, $subject, $message, $headers);
        
        // Removed log_message call for result
        
        // If failed, log the error (using standard PHP error log now)
        if (!$result) {
            global $phpmailer;
            if (isset($phpmailer) && is_a($phpmailer, 'PHPMailer\PHPMailer\PHPMailer')) {
                 error_log("Task Board Plugin Mail Error: " . $phpmailer->ErrorInfo); // Log actual error
            } else {
                 error_log("Task Board Plugin Mail Error: wp_mail failed, PHPMailer object not available or not expected class.");
            }
        }
        
        return $result;
    }
    /**
     * Send notification for approaching deadline
     * 
     * @param int $task_id The task ID
     * @param int $user_id The user ID to notify
     * @return bool Whether the email was sent
     */
    public static function send_deadline_notification($task_id, $user_id) {
        // Get task details
        $task = Pandat69_DB::get_task($task_id);
        if (!$task || !$task->deadline) {
            return false;
        }
        
        $user = get_userdata($user_id);
        if (!$user || !is_a($user, 'WP_User') || !$user->user_email) {
            return false;
        }
        
        $admin_email = get_option('admin_email');
        $site_name = get_bloginfo('name');
        $days_remaining = max(1, floor((strtotime($task->deadline) - time()) / DAY_IN_SECONDS));
        
        // Try to determine task URL
        $task_url = self::get_task_board_url($task->board_name);
        
        // translators: %s: Site name
        $subject = sprintf(__('Deadline approaching for task on %s', 'pandatask'), $site_name);
        
        // --- Plain text email ---
        // translators: %s: User display name
        $greeting = sprintf(__('Hello %s,', 'pandatask'), $user->display_name);
        
        // translators: %1$s: Task name, %2$d: Number of days
        $deadline_intro = sprintf(
            _n(
                'The deadline for task "%1$s" is approaching (%2$d day remaining).',
                'The deadline for task "%1$s" is approaching (%2$d days remaining).',
                $days_remaining,
                'pandatask'
            ),
            $task->name,
            $days_remaining
        );
        
        // translators: %s: Task name
        $task_line = sprintf(__('Task: %s', 'pandatask'), $task->name);
        // translators: %s: Task deadline date
        $deadline_line = sprintf(__('Deadline: %s', 'pandatask'), $task->deadline);
        // translators: %s: Task status
        $status_line = sprintf(__('Status: %s', 'pandatask'), ucfirst(str_replace('-', ' ', $task->status)));
        // translators: %s: Task priority
        $priority_line = sprintf(__('Priority: %s', 'pandatask'), $task->priority);
        
        $instructions = __('Please login to view the task details and update its status as needed.', 'pandatask');
        $task_link_line = '';
        if ($task_url) {
            // translators: %s: URL to the task board
            $task_link_line = sprintf(__('View Task Board: %s', 'pandatask'), $task_url) . "\n\n";
        }
        $regards = __('Regards,', 'pandatask');
        $signature = $site_name;
        
        $text_message = $greeting . "\n\n" .
                        $deadline_intro . "\n\n" .
                        $task_line . "\n" .
                        $deadline_line . "\n" .
                        $status_line . "\n" .
                        $priority_line . "\n\n" .
                        $instructions . "\n\n" .
                        $task_link_line .
                        $regards . "\n" .
                        $signature;
        
        // --- HTML email ---
        $html_message = '<p>' . esc_html($greeting) . '</p>' .
                        '<p>' . esc_html($deadline_intro) . '</p>' .
                        '<table style="border-collapse: collapse; width: 100%; margin-bottom: 20px; border: 1px solid #ddd;">' .
                            '<tr><td style="padding: 8px; border: 1px solid #ddd; width: 30%"><strong>' . esc_html__('Task', 'pandatask') . '</strong></td><td style="padding: 8px; border: 1px solid #ddd;">' . esc_html($task->name) . '</td></tr>' .
                            '<tr><td style="padding: 8px; border: 1px solid #ddd;"><strong>' . esc_html__('Deadline', 'pandatask') . '</strong></td><td style="padding: 8px; border: 1px solid #ddd;">' . esc_html($task->deadline) . '</td></tr>' .
                            '<tr><td style="padding: 8px; border: 1px solid #ddd;"><strong>' . esc_html__('Status', 'pandatask') . '</strong></td><td style="padding: 8px; border: 1px solid #ddd;">' . esc_html(ucfirst(str_replace('-', ' ', $task->status))) . '</td></tr>' .
                            '<tr><td style="padding: 8px; border: 1px solid #ddd;"><strong>' . esc_html__('Priority', 'pandatask') . '</strong></td><td style="padding: 8px; border: 1px solid #ddd;">' . esc_html($task->priority) . '</td></tr>' .
                        '</table>' .
                        '<p>' . esc_html($instructions) . '</p>' .
                        ($task_url ? '<p><a href="' . esc_url($task_url) . '" style="background-color: #384D68; color: white; padding: 10px 15px; text-decoration: none; border-radius: 4px; display: inline-block;">' . esc_html__('View Task Board', 'pandatask') . '</a></p>' : '') .
                        '<p>' . esc_html($regards) . '<br>' . esc_html($site_name) . '</p>';
        
        return self::send_email($user->user_email, $subject, $text_message, $html_message);
    }    
    /**
     * Helper function to try and find a URL for the task board
     */
    private static function get_task_board_url($board_name) {
        global $wpdb;
        
        // Removed log_message call
        
        // Check if this is a BuddyPress group board (named like "group_123")
        if (preg_match('/^group_(\d+)$/', $board_name, $matches)) {
            $group_id = intval($matches[1]);
            
            if ($group_id > 0 && function_exists('bp_get_group_permalink') && function_exists('groups_get_group')) {
                // Removed log_message call
                $group = groups_get_group($group_id);
                
                if ($group && !empty($group->slug)) { // Check slug exists
                    $group_url = bp_get_group_permalink($group);
                    $final_url = trailingslashit($group_url) . 'tasks'; 
                    
                    // Removed log_message call
                    return $final_url;
                } else {
                    // Removed log_message call
                }
            }
        }
        
        // Fallback: Try to find a page with the shortcode
        $shortcode_pattern = '[task_board board_name="' . $board_name . '"';
        $alt_shortcode_pattern = "[task_board board_name='" . $board_name . "'";
        
        $post_id = $wpdb->get_var(
            $wpdb->prepare(
                "SELECT ID FROM $wpdb->posts 
                WHERE (post_content LIKE %s OR post_content LIKE %s) 
                AND post_status = 'publish' AND post_type IN ('page', 'post') 
                ORDER BY post_date DESC 
                LIMIT 1", 
                '%' . $wpdb->esc_like($shortcode_pattern) . '%',
                '%' . $wpdb->esc_like($alt_shortcode_pattern) . '%'
            )
        );
        
        if ($post_id) {
            $url = get_permalink($post_id);
            if ($url) {
                 // Removed log_message call
                 return $url;
            }
        }
        
        // Removed log_message call
        return false; // Return false if no URL found
    }
}

--class-pandat69-group-extension.php--

<?php
/**
 * Task Board Group Extension
 */
if ( ! defined( 'ABSPATH' ) ) {
    exit;
}

// Make sure the BP_Group_Extension class exists
if ( ! class_exists( 'BP_Group_Extension' ) ) {
    // Maybe log an error or add an admin notice if this happens unexpectedly
    return;
}

class Pandat69_Group_Extension extends BP_Group_Extension {
    
    /**
     * Constructor
     */
    public function __construct() {
        // Get current group ID if available
        $group_id = bp_is_group() ? bp_get_current_group_id() : 0; // Check if we are on a group page
        
        // Default to enabled for new groups or if no group context yet
        $enabled = true; 
        
        // If we have a valid group ID, check the actual setting
        if ($group_id > 0) {
            $enabled = groups_get_groupmeta($group_id, 'pandat69_tasks_enabled', true);
            // If it's never been set, default to enabled ('1')
            if ($enabled === '') {
                $enabled = true; // Treat unset as enabled for logic below
            } else {
                $enabled = ($enabled === '1'); // Convert meta value to boolean
            }
        } else {
             // On create screen, there's no group_id yet, rely on defaults/create_screen logic
             $enabled = true;
        }
        
        $args = array(
            'slug'              => 'tasks',
            'name'              => __('Tasks', 'pandatask'), // Use __() for name, BP handles display
            'nav_item_position' => 80,
            'visibility'        => 'private', // Only visible to group members
            'show_in_create'    => true,      // Show settings during group creation
            'enable_nav_item'   => false,     // We control visibility via setup_nav_visibility
            'screens'           => array(
                'admin' => array( // Settings in Group Admin > Manage
                    'enabled' => true, 
                    'name'    => __('Tasks Settings', 'pandatask'), // Settings page title
                    'slug'    => 'task-settings', // Slug for admin sub-nav
                    'position'=> 50,
                ),
                'create' => array( // Settings during Group Create process
                    'enabled' => true,
                    'name'    => __('Tasks Settings', 'pandatask'), // Creation step title
                    'position'=> 50,
                ),
                // The main display screen is handled by screen_function below
            ),
        );
        
        parent::init($args);
        
        // Hook into navigation setup to dynamically show/hide tab based on meta
        add_action('bp_actions', array($this, 'setup_nav_visibility'), 20);
    }
    
    /**
     * Dynamically control the visibility of the "Tasks" tab based on group settings.
     */
    public function setup_nav_visibility() {
        // Only run on single group pages
        if (!bp_is_group()) {
            return;
        }
        
        $group_id = bp_get_current_group_id();
        if (!$group_id) {
            return;
        }
        
        // Check if tasks are enabled for this group ('1' means enabled)
        $enabled = groups_get_groupmeta($group_id, 'pandat69_tasks_enabled', true);
        
        // Add the nav item only if enabled is explicitly '1'
        if ($enabled === '1') {
            $group = groups_get_group($group_id);
            if (!$group) return; // Bail if group not found
    
            $group_link = bp_get_group_permalink($group);
            $current_user_id = get_current_user_id();
            
            // Use direct function calls with explicit parameters instead of context-dependent functions
            $is_member = groups_is_user_member($current_user_id, $group_id);
            $is_admin = groups_is_user_admin($current_user_id, $group_id);
            $is_mod = groups_is_user_mod($current_user_id, $group_id);
            
            bp_core_new_subnav_item(array(
                'name'            => __('Tasks', 'pandatask'),
                'slug'            => $this->slug,
                'parent_url'      => $group_link,
                'parent_slug'     => $group->slug,
                'screen_function' => array($this, 'display_screen_callback'),
                'position'        => $this->nav_item_position,
                'user_has_access' => is_user_logged_in() && ($is_member || $is_admin || $is_mod),
            ), 'groups');
        }
    }
    
    /**
     * Callback function required by screen_function in bp_core_new_subnav_item.
     * Loads the template structure.
     */
    public function display_screen_callback() {
        // Set the title for the page
        add_action( 'bp_template_title', array( $this, 'display_screen_title' ) );
        // Add the content display function
        add_action( 'bp_template_content', array( $this, 'display_screen_content' ) );
        // Load the standard BuddyPress plugin template
        bp_core_load_template( apply_filters( 'bp_core_template_plugin', 'groups/single/plugins' ) );
    }

    /** Set page title */
    public function display_screen_title() {
         echo esc_html__( 'Tasks', 'pandatask' ); 
    }
    
    /**
     * Display the actual task board content within the BP template.
     */
    public function display_screen_content() {
        $group_id = bp_get_current_group_id();
        
        // Double-check access here as well
        if ( !is_user_logged_in() || ( !bp_group_is_member() && !bp_is_item_admin() && !bp_is_item_mod() ) ) {
            echo '<div id="message" class="bp-feedback error"><span class="bp-icon" aria-hidden="true"></span><p>';
            // Use esc_html_e for safe HTML output
            esc_html_e('You must be a member of this group to view tasks.', 'pandatask');
            echo '</p></div>';
            return;
        }
        
        // Verify tasks are enabled for this group
        $enabled = groups_get_groupmeta($group_id, 'pandat69_tasks_enabled', true);
        if ($enabled !== '1') {
            echo '<div id="message" class="bp-feedback info"><span class="bp-icon" aria-hidden="true"></span><p>';
            // Use esc_html_e for safe HTML output
            esc_html_e('Tasks are currently disabled for this group.', 'pandatask');
            echo '</p></div>';
            return;
        }
        
        // Create a unique board name based on group ID
        $board_name = 'group_' . $group_id;
        
        // Display the task board using our shortcode, passing group_id and page_name (slug)
        // Shortcode output should be escaped internally if needed, but echo do_shortcode is standard.
        echo do_shortcode('[task_board board_name="' . esc_attr($board_name) . '" group_id="' . esc_attr($group_id) . '" page_name="' . esc_attr($this->slug) .'"]');
    }
    
    /**
     * Settings screen displayed during group creation.
     * screen_function for the 'create' screen defined in init().
     */
    public function create_screen($group_id = null) {
        // Check if the user is allowed to create groups
        if (!bp_is_group_creation_step($this->slug)) {
             return;
        }
        ?>
        <h4 class="bp-create-step-title"><?php esc_html_e('Task Board Settings', 'pandatask'); ?></h4>
        
        <label for="pandat69_tasks_enabled" class="bp-label">
             <input type="checkbox" name="pandat69_tasks_enabled" id="pandat69_tasks_enabled" value="1" checked="checked">
             <?php esc_html_e('Enable task board for this group?', 'pandatask'); ?>
        </label>
        <p class="description">
            <?php esc_html_e('Adds a "Tasks" tab to the group for managing projects and tasks.', 'pandatask'); ?>
        </p>
        <?php
        // Nonce for security
        wp_nonce_field( 'groups_create_save_' . $this->slug );
    }
    
    /**
     * Save settings during group creation.
     * screen_save function for the 'create' screen defined in init().
     */
    public function create_screen_save($group_id = null) {
        check_admin_referer( 'groups_create_save_' . $this->slug );
        
        // group_id is automatically passed by BuddyPress here after the group is created
        if ( !$group_id ) {
            $group_id = bp_get_new_group_id();
        }
        if (!$group_id) return; // Bail if group ID is not found

        $enabled = isset($_POST['pandat69_tasks_enabled']) ? '1' : '0';
        groups_update_groupmeta($group_id, 'pandat69_tasks_enabled', $enabled);
    }
    
    /**
     * Settings screen displayed in Group Admin > [Task Settings].
     * screen_function for the 'admin' screen defined in init().
     */
    public function edit_screen($group_id = null) {
         // Check capabilities: Must be admin or mod of the group
        if ( !bp_is_item_admin() && !bp_is_item_mod() ) {
            echo '<div id="message" class="bp-feedback error"><span class="bp-icon" aria-hidden="true"></span><p>';
            // Use esc_html_e for safe HTML output
            esc_html_e('You do not have permission to manage task settings.', 'pandatask');
            echo '</p></div>';
            return;
        }

        if (!$group_id) {
            $group_id = bp_get_current_group_id();
        }
        
        // Check if tasks are enabled ('1' means enabled, other values or unset mean disabled)
        $enabled = groups_get_groupmeta($group_id, 'pandat69_tasks_enabled', true) === '1';
        ?>
        <h4><?php esc_html_e('Task Board Settings', 'pandatask'); ?></h4>
        
        <label for="pandat69_tasks_enabled" class="bp-label">
             <input type="checkbox" name="pandat69_tasks_enabled" id="pandat69_tasks_enabled" value="1" <?php checked($enabled); ?>>
             <?php esc_html_e('Enable task board for this group?', 'pandatask'); ?>
        </label>
        <p class="description">
            <?php esc_html_e('When enabled, a "Tasks" tab will be available for group members.', 'pandatask'); ?>
        </p>
        <p class="description">
            <?php esc_html_e('Note: You might need to refresh the page after saving to see the Tasks tab appear or disappear in the navigation.', 'pandatask'); ?>
        </p>
        
        <p class="submit">
            <input type="submit" name="save" value="<?php esc_attr_e('Save Settings', 'pandatask'); ?>" class="button-primary">
        </p>
        
        <?php
        // Nonce for security
        wp_nonce_field( 'groups_edit_save_' . $this->slug );
    }
    
    /**
     * Save settings from the Group Admin screen.
     * screen_save function for the 'admin' screen defined in init().
     */
    public function edit_screen_save($group_id = null) {
         // Check if the form was actually submitted
        if ( ! isset( $_POST['save'] ) ) {
            return;
        }
        
        // Verify nonce
        check_admin_referer( 'groups_edit_save_' . $this->slug );
        
        // Check capabilities again for safety
        if ( !bp_is_item_admin() && !bp_is_item_mod() ) {
             bp_core_add_message(__('You do not have permission to save task settings.', 'pandatask'), 'error');
            return;
        }

        if (!$group_id) {
            $group_id = bp_get_current_group_id();
        }
        if (!$group_id) return; // Bail if group ID not found

        $enabled = isset($_POST['pandat69_tasks_enabled']) ? '1' : '0';
        $updated = groups_update_groupmeta($group_id, 'pandat69_tasks_enabled', $enabled);
        
        if ($updated) {
            bp_core_add_message(__('Task settings saved successfully.', 'pandatask'));
        } else {
             bp_core_add_message(__('There was an error saving task settings. Please try again.', 'pandatask'), 'error');
        }

        // Redirect back to the settings page
        $redirect_url = bp_get_group_permalink( groups_get_current_group() ) . 'admin/' . $this->screens['admin']['slug'] . '/';
        bp_core_redirect( $redirect_url );
    }

    /**
     * The display method is not directly used by BuddyPress screen functions anymore.
     * Kept for potential direct calls, but setup_nav_visibility and display_screen_content are primary now.
     * Use display_screen_content for outputting the shortcode.
     */
    // public function display( $group_id = null ) {
    //     // DEPRECATED in favor of display_screen_content
    //     $this->display_screen_content(); 
    // }
}

// Function to register the extension with BuddyPress
function pandat69_register_group_extension() {
    if ( bp_is_active( 'groups' ) ) {
        bp_register_group_extension( 'Pandat69_Group_Extension' );
    }
}
add_action( 'bp_loaded', 'pandat69_register_group_extension' ); // Register once BuddyPress is fully loaded

--class-pandat69-notifications.php--

<?php
if ( ! defined( 'ABSPATH' ) ) {
    exit;
}

/**
 * Class for handling BuddyPress notifications integration
 * 
 * Adds notifications for:
 * - When a user is assigned to a task
 * - When a comment is added to a task the user is assigned to
 * - When a user is @mentioned in a comment
 */
class Pandat69_Notifications {

    /**
     * Initialize the notifications integration
     */
    public static function init() {
        // Only register if BuddyPress and the notifications component are active
        if (!self::is_bp_notifications_active()) {
            return;
        }

        // Register our component with BuddyPress notifications system
        add_filter('bp_notifications_get_registered_components', array(__CLASS__, 'register_component'));
        
        // Format the notifications
        add_filter('bp_notifications_get_notifications_for_user', array(__CLASS__, 'format_notifications'), 10, 8);
        
        // Add action to process notification read status
        add_action('wp', array(__CLASS__, 'process_notification_read'));
    }
    
    /**
     * Register our component with BuddyPress notifications
     *
     * @param array $components Registered components
     * @return array Modified components array
     */
    public static function register_component($components) {
        // Add 'pandatask' to the array of registered components
        if (!in_array('pandatask', $components)) {
            $components[] = 'pandatask';
        }
        return $components;
    }
    
    /**
     * Format the notifications for display
     */
    public static function format_notifications($action, $item_id, $secondary_item_id, $total_items, $format = 'string', $component_action_name = '', $component_name = '', $notification_id = 0) {
        // We need to check both our parameters and the legacy ones because BuddyPress may pass them differently
        if ($component_name !== 'pandatask' && $component_action_name !== $action) {
            return $action;
        }
        
        // Default output formats
        $title = '';
        $link = '';
        
        // Get the relevant action - use component_action_name if available, otherwise fallback to $action
        $notification_action = !empty($component_action_name) ? $component_action_name : $action;
        
        // Handle different notification types
        switch ($notification_action) {
            case 'task_assignment':
                // Get the task details
                $task = Pandat69_DB::get_task($item_id);
                if (!$task) return $action;
                
                // Get the assigner's details (secondary_item_id is the user who assigned the task)
                $assigner = get_userdata($secondary_item_id);
                $assigner_name = $assigner ? $assigner->display_name : __('Someone', 'pandatask');
                
                // Create the notification text
                $title = sprintf(
                    __('%s assigned you to task: %s', 'pandatask'),
                    $assigner_name,
                    $task->name
                );
                
                // Generate the link to the task board
                $link = self::get_task_board_url($task->board_name);
                break;
                
            case 'task_comment':
                // Get the task details
                $task = Pandat69_DB::get_task($item_id);
                if (!$task) return $action;
                
                // Get the commenter's details
                $commenter = get_userdata($secondary_item_id);
                $commenter_name = $commenter ? $commenter->display_name : __('Someone', 'pandatask');
                
                // Create the notification text
                $title = sprintf(
                    __('%s commented on task: %s', 'pandatask'),
                    $commenter_name,
                    $task->name
                );
                
                // Generate the link to the task board
                $link = self::get_task_board_url($task->board_name);
                break;
                
            case 'task_mention':
                // Get the task details
                $task = Pandat69_DB::get_task($item_id);
                if (!$task) return $action;
                
                // Get the mentioner's details
                $mentioner = get_userdata($secondary_item_id);
                $mentioner_name = $mentioner ? $mentioner->display_name : __('Someone', 'pandatask');
                
                // Create the notification text
                $title = sprintf(
                    __('%s mentioned you in task: %s', 'pandatask'),
                    $mentioner_name,
                    $task->name
                );
                
                // Generate the link to the task board
                $link = self::get_task_board_url($task->board_name);
                break;
                
            case 'task_deadline':
                // Get the task details
                $task = Pandat69_DB::get_task($item_id);
                if (!$task) return $action;
                
                // Calculate days remaining
                $days_remaining = max(1, floor((strtotime($task->deadline) - time()) / DAY_IN_SECONDS));
                
                // Create the notification text
                $title = sprintf(
                    _n(
                        'Deadline approaching for task: %s (%d day remaining)',
                        'Deadline approaching for task: %s (%d days remaining)',
                        $days_remaining,
                        'pandatask'
                    ),
                    $task->name,
                    $days_remaining
                );
                
                // Generate the link to the task board
                $link = self::get_task_board_url($task->board_name);
                break;
                
            default:
                return $action;
        }
        
        // Add notification parameters to mark as read when clicked
        if ($link && $notification_id) {
            $link = add_query_arg(array(
                'pandat69_notification_id' => $notification_id,
                'pandat69_notification_action' => $notification_action
            ), $link);
        }
        
        // Format based on requested format
        if ('string' === $format) {
            // Return the title with a link
            return '<a href="' . esc_url($link) . '">' . esc_html($title) . '</a>';
        } else {
            // Return an array
            return array(
                'text' => $title,
                'link' => $link
            );
        }
    }
    
    /**
     * Process notification parameters and mark as read if needed
     * Should be called early in the page load
     */
    public static function process_notification_read() {
        // Check if we have notification parameters
        if (!isset($_GET['pandat69_notification_id']) || !isset($_GET['pandat69_notification_action'])) {
            return;
        }
        
        // Only process if BuddyPress notifications are active
        if (!self::is_bp_notifications_active()) {
            return;
        }
        
        // Get parameters
        $notification_id = absint($_GET['pandat69_notification_id']);
        $notification_action = sanitize_text_field($_GET['pandat69_notification_action']);
        
        // Verify the user's access to this notification
        if (!$notification_id || !BP_Notifications_Notification::check_access(get_current_user_id(), $notification_id)) {
            return;
        }
        
        // Mark the notification as read
        BP_Notifications_Notification::update(
            array('is_new' => 0),
            array('id' => $notification_id)
        );
        
        // Optionally, redirect to clean URL (removes notification parameters)
        // Uncomment if you want to clean the URL after processing
        /*
        $redirect_url = remove_query_arg(
            array('pandat69_notification_id', 'pandat69_notification_action')
        );
        wp_redirect($redirect_url);
        exit;
        */
    }
    
    /**
     * Send a notification for task assignment
     * 
     * @param int $task_id The task ID
     * @param int $user_id The user being assigned
     * @param int $assigner_id The user who made the assignment
     * @return bool|int False on failure, notification ID on success
     */
    public static function add_assignment_notification($task_id, $user_id, $assigner_id) {
        if (!self::is_bp_notifications_active()) {
            return false;
        }
        
        return bp_notifications_add_notification(array(
            'user_id'           => $user_id,
            'item_id'           => $task_id,
            'secondary_item_id' => $assigner_id,
            'component_name'    => 'pandatask',
            'component_action'  => 'task_assignment',
            'date_notified'     => bp_core_current_time(),
            'is_new'            => 1,
        ));
    }
    
    /**
     * Send a notification for a task comment
     * 
     * @param int $task_id The task ID
     * @param int $user_id The user to notify
     * @param int $commenter_id The user who commented
     * @return bool|int False on failure, notification ID on success
     */
    public static function add_comment_notification($task_id, $user_id, $commenter_id) {
        if (!self::is_bp_notifications_active()) {
            return false;
        }
        
        return bp_notifications_add_notification(array(
            'user_id'           => $user_id,
            'item_id'           => $task_id,
            'secondary_item_id' => $commenter_id,
            'component_name'    => 'pandatask',
            'component_action'  => 'task_comment',
            'date_notified'     => bp_core_current_time(),
            'is_new'            => 1,
        ));
    }
    
    /**
     * Send a notification for an @mention
     * 
     * @param int $task_id The task ID
     * @param int $user_id The user being mentioned
     * @param int $mentioner_id The user who mentioned them
     * @return bool|int False on failure, notification ID on success
     */
    public static function add_mention_notification($task_id, $user_id, $mentioner_id) {
        if (!self::is_bp_notifications_active()) {
            return false;
        }
        
        return bp_notifications_add_notification(array(
            'user_id'           => $user_id,
            'item_id'           => $task_id,
            'secondary_item_id' => $mentioner_id,
            'component_name'    => 'pandatask',
            'component_action'  => 'task_mention',
            'date_notified'     => bp_core_current_time(),
            'is_new'            => 1,
        ));
    }
    
    /**
     * Helper function to get a URL for the task board
     * 
     * @param string $board_name The board name
     * @return string|false The URL or false if not found
     */
    public static function get_task_board_url($board_name) {
        // Reuse the same logic from Pandat69_Email::get_task_board_url
        global $wpdb;
        
        // Check if this is a BuddyPress group board (named like "group_123")
        if (preg_match('/^group_(\d+)$/', $board_name, $matches)) {
            $group_id = intval($matches[1]);
            
            if ($group_id > 0 && function_exists('bp_get_group_permalink') && function_exists('groups_get_group')) {
                $group = groups_get_group($group_id);
                
                if ($group && !empty($group->slug)) {
                    $group_url = bp_get_group_permalink($group);
                    return trailingslashit($group_url) . 'tasks';
                }
            }
        }
        
        // Fallback: Try to find a page with the shortcode
        $shortcode_pattern = '[task_board board_name="' . $board_name . '"';
        $alt_shortcode_pattern = "[task_board board_name='" . $board_name . "'";
        
        $post_id = $wpdb->get_var(
            $wpdb->prepare(
                "SELECT ID FROM $wpdb->posts 
                WHERE (post_content LIKE %s OR post_content LIKE %s) 
                AND post_status = 'publish' AND post_type IN ('page', 'post') 
                ORDER BY post_date DESC 
                LIMIT 1", 
                '%' . $wpdb->esc_like($shortcode_pattern) . '%',
                '%' . $wpdb->esc_like($alt_shortcode_pattern) . '%'
            )
        );
        
        if ($post_id) {
            return get_permalink($post_id);
        }
        
        return false;
    }
    
    /**
     * Check if BuddyPress notifications component is active
     * 
     * @return bool True if BuddyPress notifications is active
     */
    public static function is_bp_notifications_active() {
        return function_exists('buddypress') && 
               function_exists('bp_is_active') && 
               bp_is_active('notifications') &&
               class_exists('BP_Notifications_Notification');
    }
    /**
     * Send a notification for an approaching deadline
     * 
     * @param int $task_id The task ID
     * @param int $user_id The user to notify
     * @return bool|int False on failure, notification ID on success
     */
    public static function add_deadline_notification($task_id, $user_id) {
        if (!self::is_bp_notifications_active()) {
            return false;
        }
        
        return bp_notifications_add_notification(array(
            'user_id'           => $user_id,
            'item_id'           => $task_id,
            'secondary_item_id' => 0,
            'component_name'    => 'pandatask',
            'component_action'  => 'task_deadline',
            'date_notified'     => bp_core_current_time(),
            'is_new'            => 1,
        ));
    }    
    /**
     * Debug BuddyPress notifications for a user
     * 
     * @param int $user_id The user ID to debug notifications for
     */
    public static function debug_notifications($user_id = 0) {
        if (!self::is_bp_notifications_active()) {
            return;
        }
        
        if (!$user_id) {
            $user_id = get_current_user_id();
        }
        
        // Get notifications for the user
        $notifications = BP_Notifications_Notification::get(array(
            'user_id' => $user_id,
        ));
        
        error_log('Debugging BP notifications for user ' . $user_id);
        error_log('Found ' . count($notifications) . ' notifications');
        
        foreach ($notifications as $notification) {
            error_log(sprintf(
                'Notification ID: %d, Component: %s, Action: %s, Item ID: %d, Secondary ID: %d, Date: %s, Is New: %d',
                $notification->id,
                $notification->component_name,
                $notification->component_action,
                $notification->item_id,
                $notification->secondary_item_id,
                $notification->date_notified,
                $notification->is_new
            ));
        }
        
        // Try to get the formatted notifications
        $formatted = bp_notifications_get_notifications_for_user($user_id, 'array');
        error_log('Formatted notifications: ' . print_r($formatted, true));
        
        // List registered components
        $components = apply_filters('bp_notifications_get_registered_components', array());
        error_log('Registered notification components: ' . print_r($components, true));
    }
}

--class-pandat69-shortcode.php--

<?php
if ( ! defined( 'ABSPATH' ) ) {
    exit;
}

class Pandat69_Shortcode {

    public function register() {
        add_shortcode( 'task_board', array( $this, 'render_shortcode' ) );
    }

    public function render_shortcode( $atts ) {
        $atts = shortcode_atts( array(
            'board_name' => 'default_board',
            'group_id' => 0,
            'page_name' => '',
        ), $atts, 'task_board' );
    
        $board_name = sanitize_key( $atts['board_name'] );
        $group_id = absint( $atts['group_id'] );
        $page_name = sanitize_title( $atts['page_name'] );
        
        // Get a display name for the board
        $display_name = $this->get_board_display_name($board_name, $group_id);
        
        ob_start();
        ?>
        <div class="pandat69-container" 
             id="pandat69-container-<?php echo esc_attr($board_name); ?>" 
             data-board-name="<?php echo esc_attr($board_name); ?>"
             <?php 
             // Output group_id attribute only if it exists
             if ($group_id > 0) { 
                 echo ' data-group-id="' . esc_attr($group_id) . '"'; 
             } 
             // Output page_name attribute only if it exists
             if (!empty($page_name)) { 
                 echo ' data-page-name="' . esc_attr($page_name) . '"'; 
             } 
             ?>>
            <div class="pandat69-header">
                <h2>Task Board: <?php echo esc_html($display_name); ?></h2>
            </div>
            
            <div class="pandat69-tabs">
                <ul class="pandat69-tab-navigation">
                    <li class="pandat69-tab-item active" data-tab="all">Task List</li>
                    <li class="pandat69-tab-item" data-tab="week">Week Overview</li>
                    <li class="pandat69-tab-item" data-tab="month">Month Overview</li>
                </ul>
                
                <!-- "All" tab - existing content -->
                <div class="pandat69-tab-content pandat69-tab-all active">
                    <div class="pandat69-controls">
                        <button class="pandat69-button pandat69-add-task-btn">Add New Task</button>
                        <button class="pandat69-button pandat69-manage-categories-btn">Manage Categories</button>
                    </div>
                    <div class="pandat69-filters">
                        <input type="text" class="pandat69-input pandat69-search-input" placeholder="Search tasks...">
                        <select class="pandat69-select pandat69-sort-select">
                            <option value="name_asc">Sort by Name (A-Z)</option>
                            <option value="name_desc">Sort by Name (Z-A)</option>
                            <option value="priority_asc">Sort by Priority (Low-High)</option>
                            <option value="priority_desc">Sort by Priority (High-Low)</option>
                            <option value="deadline_asc">Sort by Deadline (Soonest)</option>
                            <option value="deadline_desc">Sort by Deadline (Latest)</option>
                            <option value="status_asc">Sort by Status (A-Z)</option>
                            <option value="status_desc">Sort by Status (Z-A)</option>
                        </select>
                        <select class="pandat69-select pandat69-status-filter-select">
                            <option value="">All Statuses</option>
                            <option value="pending">Pending</option>
                            <option value="in-progress">In Progress</option>
                            <option value="done">Done</option>
                        </select>
                    </div>
                    <div class="pandat69-task-list-container">
                        <div class="pandat69-loading" style="display: none;">Loading...</div>
                        <ul class="pandat69-task-list">
                            <!-- Tasks will be loaded here by JavaScript -->
                        </ul>
                    </div>
                </div>
                
                <!-- Week overview tab -->
                <div class="pandat69-tab-content pandat69-tab-week">
                    <div class="pandat69-date-selector">
                        <button class="pandat69-button pandat69-prev-week">◀ Previous Week</button>
                        <span class="pandat69-current-week-display"></span>
                        <button class="pandat69-button pandat69-next-week">Next Week ▶</button>
                    </div>
                    <div class="pandat69-week-task-container">
                        <!-- Week tasks will be loaded here -->
                    </div>
                </div>
                
                <!-- Month overview tab -->
                <div class="pandat69-tab-content pandat69-tab-month">
                    <div class="pandat69-date-selector">
                        <button class="pandat69-button pandat69-prev-month">◀ Previous Month</button>
                        <span class="pandat69-current-month-display"></span>
                        <button class="pandat69-button pandat69-next-month">Next Month ▶</button>
                    </div>
                    <div class="pandat69-month-task-container">
                        <!-- Month tasks will be loaded here -->
                    </div>
                </div>
            </div>
    
            <!-- Add Task Expandable Section -->
            <div class="pandat69-expandable-section pandat69-add-task-section" style="display: none;">
                <div class="pandat69-expandable-header">
                    <h3>Add New Task</h3>
                    <button type="button" class="pandat69-icon-button pandat69-close-expandable">×</button>
                </div>
                <div class="pandat69-expandable-content">
                    <form class="pandat69-form pandat69-task-form">
                        <input type="hidden" id="pandat69-task-id" name="task_id" value="">
                        <input type="hidden" id="pandat69-board-name" name="board_name" value="<?php echo esc_attr($board_name); ?>">
    
                        <div class="pandat69-form-field">
                            <label for="pandat69-task-name">Task Name:</label>
                            <input type="text" id="pandat69-task-name" name="name" class="pandat69-input" required>
                        </div>
    
                         <div class="pandat69-form-field">
                            <label for="pandat69-task-description">Description:</label>
                            <textarea id="pandat69-task-description" name="description" class="pandat69-input pandat69-tinymce-editor" rows="6"></textarea>
                        </div>
    
                        <div class="pandat69-form-row">
                            <div class="pandat69-form-field pandat69-form-field-half">
                                <label for="pandat69-task-status">Status:</label>
                                <select id="pandat69-task-status" name="status" class="pandat69-select">
                                    <option value="pending">Pending</option>
                                    <option value="in-progress">In Progress</option>
                                    <option value="done">Done</option>
                                </select>
                            </div>
                             <div class="pandat69-form-field pandat69-form-field-half">
                                <label for="pandat69-task-priority">Priority (1-10):</label>
                                <input type="number" id="pandat69-task-priority" name="priority" class="pandat69-input" min="1" max="10" value="5" required>
                             </div>
                        </div>
    
                        <div class="pandat69-form-row">
                            <div class="pandat69-form-field pandat69-form-field-half">
                                <label for="pandat69-task-category">Category:</label>
                                <div class="pandat69-category-input-group">
                                    <select id="pandat69-task-category" name="category_id" class="pandat69-select">
                                        <option value="">-- Select Category --</option>
                                        <!-- Categories loaded by JS -->
                                    </select>
                                    <button type="button" class="pandat69-icon-button pandat69-add-category-inline-btn" title="Add New Category">+</button>
                                </div>
                                <!-- Inline category form - hidden by default -->
                                <div class="pandat69-inline-category-form" style="display: none;">
                                    <div class="pandat69-inline-form-row">
                                        <input type="text" class="pandat69-input pandat69-new-category-name-inline" placeholder="New category name">
                                        <button type="button" class="pandat69-button pandat69-save-category-inline-btn">Add</button>
                                        <button type="button" class="pandat69-button pandat69-cancel-category-inline-btn">Cancel</button>
                                    </div>
                                    <div class="pandat69-inline-form-message" style="display: none;"></div>
                                </div>
                            </div>
                            <div class="pandat69-form-field pandat69-form-field-half">
                                <label for="pandat69-task-deadline">Deadline:</label>
                                <input type="text" id="pandat69-task-deadline" name="deadline" class="pandat69-input pandat69-datepicker" placeholder="YYYY-MM-DD">
                            </div>
                        </div>
                        <div class="pandat69-form-field">
                            <label for="pandat69-notify-deadline">
                                <input type="checkbox" id="pandat69-notify-deadline" name="notify_deadline" value="1">
                                Enable deadline notifications
                            </label>
                            <div class="pandat69-deadline-notification-days" style="margin-top: 8px; display: none;">
                                <label for="pandat69-notify-days-before">Notify days before deadline:</label>
                                <input type="number" id="pandat69-notify-days-before" name="notify_days_before" class="pandat69-input" min="1" max="30" value="3">
                                <p class="description">Users assigned to this task will be notified this many days before the deadline.</p>
                            </div>
                        </div>    
                        <div class="pandat69-form-field">
                            <label for="pandat69-task-assigned-search">Assign Persons:</label>
                            <div class="pandat69-user-autocomplete-container">
                                <input type="text" id="pandat69-task-assigned-search" class="pandat69-input pandat69-user-search-input" placeholder="Type to search users...">
                                <div class="pandat69-user-suggestions" style="display: none;"></div>
                                <div class="pandat69-selected-users-container"></div>
                                <!-- Hidden field to store the actual user IDs -->
                                <input type="hidden" id="pandat69-task-assigned" name="assigned_persons" value="">
                            </div>
                        </div>
    
                        <div class="pandat69-form-actions">
                            <button type="submit" class="pandat69-button pandat69-submit-task-btn">Save Task</button>
                            <button type="button" class="pandat69-button pandat69-cancel-task-btn">Cancel</button>
                            <div class="pandat69-form-message" style="display: none;"></div>
                        </div>
                    </form>
                </div>
            </div>
    
            <!-- Categories Management Expandable Section -->
            <div class="pandat69-expandable-section pandat69-categories-section" style="display: none;">
                <div class="pandat69-expandable-header">
                    <h3>Manage Categories</h3>
                    <button type="button" class="pandat69-icon-button pandat69-close-expandable">×</button>
                </div>
                <div class="pandat69-expandable-content">
                    <div class="pandat69-category-list-container">
                        <ul class="pandat69-category-list">
                            <!-- Categories loaded by JS -->
                        </ul>
                    </div>
                    <form class="pandat69-form pandat69-add-category-form">
                        <div class="pandat69-form-field">
                            <label for="pandat69-new-category-name">New Category Name:</label>
                            <input type="text" id="pandat69-new-category-name" name="name" class="pandat69-input" required>
                        </div>
                        <div class="pandat69-form-actions">
                            <button type="submit" class="pandat69-button pandat69-add-category-btn">Add Category</button>
                            <div class="pandat69-form-message pandat69-category-form-message" style="display: none;"></div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <?php
        return ob_get_clean();
    }
    
    /**
     * Get a human-readable display name for the board
     *
     * @param string $board_name The internal board name
     * @param int $group_id The group ID if available
     * @return string The display name for the board
     */
    private function get_board_display_name($board_name, $group_id = 0) {
        // Check if this is a BuddyPress group board
        if (preg_match('/^group_(\d+)$/', $board_name, $matches)) {
            $detected_group_id = intval($matches[1]);
            
            // Use the provided group_id if available, otherwise use the one from the board name
            $group_id = ($group_id > 0) ? $group_id : $detected_group_id;
            
            // Get the group name if BuddyPress is active
            if (function_exists('groups_get_group') && $group_id > 0) {
                $group = groups_get_group($group_id);
                if ($group && !empty($group->name)) {
                    return esc_html($group->name);
                }
            }
        }
        
        // Fallback: Format the board name nicely
        $display_name = str_replace('_', ' ', $board_name);
        return ucwords($display_name);
    }
}